---
- name: Ensure backup dir
  ansible.builtin/file: { path: "{{ backup.dest_dir }}", state: directory, mode: "0750" }
- name: Show running-config
  when: apply_changes | bool and backup.enable | bool
  arista.eos.eos_command:
    commands: ["show running-config"]
  register: run_cfg
- name: Save file
  when: apply_changes | bool and run_cfg.stdout is defined
  ansible.builtin/copy:
    dest: "{{ backup.dest_dir }}/{{ inventory_hostname }}.cfg"
    content: "{{ run_cfg.stdout[0] }}"
    mode: "0640"
- name: Restore preview
  when: restore.candidate | length > 0
  ansible.builtin.debug:
    msg: "Would restore from {{ restore.candidate }} (dry_run={{ restore.dry_run }})"
