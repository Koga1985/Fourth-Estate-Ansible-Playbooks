---
# handlers file for arista_cvp_inventory_model

- name: refresh cvp facts
  arista.cvp.cv_facts_v3:
    facts:
      - devices
      - containers
      - configlets
      - tasks
  register: cvp_facts_refreshed
  delegate_to: localhost
  listen: refresh cvp facts

- name: backup cvp configuration
  ansible.builtin.copy:
    dest: "{{ cvp_backup_location }}/cvp_backup_{{ ansible_date_time.epoch }}.json"
    content: "{{ cvp_facts | to_nice_json }}"
    mode: "0644"
  delegate_to: localhost
  when: cvp_backup_enabled | default(true)
  listen: backup cvp configuration
