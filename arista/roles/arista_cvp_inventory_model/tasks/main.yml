---
- name: Ensure artifacts dir
  ansible.builtin/file: { path: "{{ artifacts_dir }}", state: directory }
- name: Plan CVP
  ansible.builtin/copy:
    dest: "{{ artifacts_dir }}/cvp_plan.json"
    content: "{{ cvp | to_nice_json }}"
    mode: "0644"
- name: Containers
  when: apply_changes | bool and (cvp.containers | length) > 0
  arista.cvp.cv_container_v3:
    state: present
    containers: "{{ cvp.containers }}"
- name: Configlets
  when: apply_changes | bool and (cvp.configlets | length) > 0
  arista.cvp.cv_configlet_v3:
    state: present
    configlets: "{{ cvp.configlets }}"
- name: Devices
  when: apply_changes | bool and (cvp.devices | length) > 0
  arista.cvp.cv_device_v3:
    state: present
    devices: "{{ cvp.devices }}"
