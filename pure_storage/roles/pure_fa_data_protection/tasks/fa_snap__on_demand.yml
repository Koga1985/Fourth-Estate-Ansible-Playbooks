
- name: Create on-demand snapshots
  purestorage.flasharray.purefa_snap:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    target: "{{ item.name }}"
    snap: "{{ item.suffix | default(omit) }}"
    pgroup: "{{ (item.type | lower) == 'pgroup' }}"
    state: present
  loop: "{{ snap_jobs | default([]) }}"
  loop_control: { label: "{{ item.type }}:{{ item.name }}@{{ item.suffix | default('now') }}" }
