
- name: Map/Unmap volumes to hosts/hostgroups
  purestorage.flasharray.purefa_connect:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    volume: "{{ item.volume }}"
    host: "{{ item.host | default(omit) }}"
    hgroup: "{{ item.hgroup | default(omit) }}"
    lun: "{{ item.lun | default(omit) }}"
    state: "{{ item.state | default('present') }}"
  loop: "{{ mappings | default([]) }}"
  loop_control: { label: "{{ item.volume }} -> {{ item.host | default(item.hgroup) }}" }
