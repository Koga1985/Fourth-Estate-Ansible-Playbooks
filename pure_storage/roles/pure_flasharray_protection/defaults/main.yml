---
# Pure Storage FlashArray Protection Defaults

# Array connection
flasharray_url: "https://{{ inventory_hostname }}"
# flasharray_api_token: defined in vault

# Protection groups
# flasharray_protection_groups:
#   - name: "pg-production-db"
#     enabled: true
#   - name: "pg-application-tier"
#     enabled: true
#   - name: "pg-web-servers"
#     enabled: true

# Add volumes to protection groups
# flasharray_pg_volumes:
#   - pg_name: "pg-production-db"
#     volume: "vol-db-01"
#   - pg_name: "pg-production-db"
#     volume: "vol-db-log-01"

# Add hosts to protection groups
# flasharray_pg_hosts:
#   - pg_name: "pg-web-servers"
#     host: "web-01"
#   - pg_name: "pg-web-servers"
#     host: "web-02"

# Add host groups to protection groups
# flasharray_pg_hostgroups:
#   - pg_name: "pg-vmware-vms"
#     hostgroup: "vmware-cluster-prod"

# 15-minute snapshot schedules (RPO: 15 minutes)
# flasharray_pg_15min_schedule:
#   - name: "pg-production-db"
#     days: 7  # Keep 7 days of 15-min snapshots

# Hourly snapshot schedules
# flasharray_pg_hourly_schedule:
#   - name: "pg-production-db"
#     days: 30  # Keep 30 days of hourly snapshots

# Daily snapshot schedules
# flasharray_pg_daily_schedule:
#   - name: "pg-production-db"
#     snap_at: "02:00"  # 2 AM daily
#     days: 365  # Keep 1 year of daily snapshots

# SafeMode protection groups (immutable snapshots)
# flasharray_safemode_protection_groups:
#   - name: "pg-critical-data"
#     eradication_config: "24hours"
#   - name: "pg-compliance-data"
#     eradication_config: "7days"

# Retention policies
# flasharray_retention_policies:
#   - name: "short-term"
#     retention: 7  # days
#   - name: "medium-term"
#     retention: 30  # days
#   - name: "long-term"
#     retention: 365  # days
#   - name: "compliance"
#     retention: 2555  # 7 years

# Manual snapshots
# flasharray_manual_snapshots:
#   - source: "vol-db-01"
#     suffix: "pre-upgrade"
#   - source: "vol-app-01"
#     suffix: "before-patch"

# Protection group manual snapshots
# flasharray_pg_manual_snapshots:
#   - pg_name: "pg-production-db"
#     suffix: "pre-maintenance"

# Volume restores
# flasharray_volume_restores:
#   - volume: "vol-db-01"
#     snapshot: "vol-db-01.pre-upgrade"

# Consistency groups
# flasharray_consistency_groups:
#   - name: "cg-oracle-rac"
#   - name: "cg-sql-cluster"

# Consistency group volumes
# flasharray_cg_volumes:
#   - cg_name: "cg-oracle-rac"
#     volume: "vol-oracle-data-01"
#   - cg_name: "cg-oracle-rac"
#     volume: "vol-oracle-log-01"

# Consistency group snapshots
# flasharray_cg_snapshots:
#   - cg_name: "cg-oracle-rac"
#     suffix: "crash-consistent"

# Eradication timer (deleted objects retention)
flasharray_eradication_timer: 86400  # 24 hours (in seconds)

# Snapshots to delete
# flasharray_snapshots_to_delete:
#   - "vol-old-01.old-snapshot"

# Fourth Estate evidence preservation
flasharray_evidence_pg: "pg-evidence-preservation"
flasharray_evidence_retention_days: 2555  # 7 years

# Default snapshot schedules
flasharray_default_snapshot_schedules:
  critical_15min:
    frequency: 900  # 15 minutes
    retention_days: 7
  standard_hourly:
    frequency: 3600  # 1 hour
    retention_days: 30
  daily_backup:
    frequency: 86400  # 24 hours
    retention_days: 365
    snap_at: "02:00"
  weekly_archive:
    frequency: 604800  # 7 days
    retention_days: 730
    snap_at: "Sunday 02:00"

# Snapshot retention tiers
flasharray_snapshot_retention_tiers:
  short_term: 7  # days
  medium_term: 30  # days
  long_term: 365  # days
  compliance: 2555  # 7 years (Fourth Estate requirement)

# SafeMode configuration
flasharray_safemode_enabled: true
flasharray_safemode_retention_minimum: 24  # hours (cannot delete before this)
flasharray_safemode_retention_default: 168  # hours (7 days default)
flasharray_safemode_compliance_mode: true

# Application-consistent snapshots
flasharray_app_consistent_snapshots: true
flasharray_quiesce_timeout: 300  # seconds

# Snapshot naming convention
flasharray_snapshot_suffix_format: "{{ ansible_date_time.iso8601_basic_short }}"
flasharray_snapshot_prefix: "snap"

# Protection policies
flasharray_protection_policies:
  tier1_critical:
    rpo_minutes: 15
    retention_days: 365
    safemode: true
  tier2_important:
    rpo_minutes: 60
    retention_days: 90
    safemode: true
  tier3_standard:
    rpo_hours: 24
    retention_days: 30
    safemode: false

# Ransomware protection
flasharray_ransomware_protection_enabled: true
flasharray_immutable_snapshots: true
flasharray_snapshot_locking: true

# Disaster recovery
flasharray_dr_snapshot_replication: true
flasharray_dr_rpo_minutes: 15

# Compliance and audit
flasharray_snapshot_audit_logging: true
flasharray_snapshot_catalog_enabled: true
flasharray_snapshot_verification: true

# Performance impact
flasharray_snapshot_performance_impact: "minimal"  # Pure's redirect-on-write
flasharray_snapshot_space_reclamation: "automatic"

# Fourth Estate specific protection groups
flasharray_fourth_estate_protection_groups:
  - name: "pg-editorial-content"
    rpo_minutes: 15
    retention_days: 365
    safemode: true
  - name: "pg-source-material"
    rpo_minutes: 60
    retention_days: 2555  # 7 years
    safemode: true
  - name: "pg-publishing-systems"
    rpo_minutes: 15
    retention_days: 90
    safemode: true
  - name: "pg-media-archives"
    rpo_hours: 6
    retention_days: 2555
    safemode: true
