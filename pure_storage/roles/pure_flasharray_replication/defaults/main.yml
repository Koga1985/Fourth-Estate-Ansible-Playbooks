---
# Pure Storage FlashArray Replication Defaults

# Array connection
flasharray_url: "https://{{ inventory_hostname }}"
# flasharray_api_token: defined in vault

# Replication targets (for ActiveDR)
# flasharray_replication_targets:
#   - target_url: "https://flasharray-dr.example.com"
#     target_api_token: "{{ dr_array_api_token }}"  # in vault

# ActiveCluster arrays (synchronous replication)
# flasharray_activecluster_arrays:
#   - target_url: "https://flasharray-dc2.example.com"
#     target_api_token: "{{ dc2_array_api_token }}"  # in vault
#     transport: "ip"  # or "fc" for Fibre Channel

# ActiveCluster pods
# flasharray_activecluster_pods:
#   - name: "pod-production-db"
#   - name: "pod-vmware-cluster"
#   - name: "pod-k8s-storage"

# Stretched pods (ActiveCluster)
# flasharray_stretched_pods:
#   - pod_name: "pod-production-db"
#     target_array: "flasharray-dc2"
#   - pod_name: "pod-vmware-cluster"
#     target_array: "flasharray-dc2"

# Volumes in pods
# flasharray_pod_volumes:
#   - pod_name: "pod-production-db"
#     volume_name: "db-data-01"
#     size: 5T
#   - pod_name: "pod-production-db"
#     volume_name: "db-log-01"
#     size: 1T

# ActiveDR protection groups
# flasharray_activedr_pgroups:
#   - pg_name: "pg-application-tier"
#     target_array: "flasharray-dr"
#   - pg_name: "pg-file-services"
#     target_array: "flasharray-dr"

# Replication schedules
# flasharray_replication_schedules:
#   - pg_name: "pg-application-tier"
#     target_array: "flasharray-dr"
#     replicate_frequency: 900  # 15 minutes (RPO: 15 min)
#   - pg_name: "pg-file-services"
#     target_array: "flasharray-dr"
#     replicate_frequency: 3600  # 1 hour (RPO: 1 hour)

# Replication bandwidth limits
# flasharray_replication_bandwidth:
#   - target_url: "https://flasharray-dr.example.com"
#     target_api_token: "{{ dr_array_api_token }}"
#     bandwidth_limit: 1G  # 1 Gbps

# Replication network interfaces
# flasharray_replication_interfaces:
#   - interface: "ct0.eth2"
#     address: "10.10.1.10"
#     netmask: "255.255.255.0"
#     gateway: "10.10.1.1"
#     mtu: 9000
#   - interface: "ct1.eth2"
#     address: "10.10.1.11"
#     netmask: "255.255.255.0"
#     mtu: 9000

# Continuous replication
# flasharray_continuous_replication:
#   - pg_name: "pg-critical-data"
#     target_array: "flasharray-dr"

# RPO targets (in seconds)
# flasharray_rpo_targets:
#   - pg_name: "pg-tier1"
#     target_array: "flasharray-dr"
#     rpo_seconds: 900  # 15 minutes
#   - pg_name: "pg-tier2"
#     target_array: "flasharray-dr"
#     rpo_seconds: 3600  # 1 hour

# Pause replication (for maintenance)
# flasharray_pause_replication:
#   - "pg-maintenance-window"

# Resume replication
# flasharray_resume_replication:
#   - "pg-maintenance-complete"

# Failover (promote replica to primary)
# flasharray_failover_pgroups:
#   - pg_name: "pg-disaster-recovery"

# Failback (demote primary to replica)
# flasharray_failback_pgroups:
#   - pg_name: "pg-back-to-production"

# Default RPO settings
flasharray_default_rpo_minutes: 15
flasharray_critical_rpo_minutes: 5
flasharray_standard_rpo_minutes: 60

# ActiveCluster settings
flasharray_activecluster_enabled: false
flasharray_activecluster_rpo: 0  # Synchronous (zero RPO)
flasharray_activecluster_auto_failover: true
flasharray_activecluster_witness: true

# ActiveDR settings
flasharray_activedr_enabled: true
flasharray_activedr_compression: true
flasharray_activedr_dedupe: true

# Replication types
flasharray_replication_types:
  activecluster:
    type: "synchronous"
    rpo: 0
    rto_minutes: 0
    use_case: "zero downtime, active-active"
  activedr:
    type: "asynchronous"
    rpo_minutes: 15
    rto_minutes: 15
    use_case: "disaster recovery"

# Network optimization
flasharray_replication_use_jumbo_frames: true
flasharray_replication_mtu: 9000
flasharray_replication_compression: true

# Bandwidth management
flasharray_replication_bandwidth_unlimited: false
flasharray_default_replication_bandwidth: "1G"

# Failover and failback
flasharray_automated_failover: false
flasharray_planned_failover_allowed: true
flasharray_failback_requires_approval: true

# Monitoring and alerting
flasharray_monitor_replication_lag: true
flasharray_replication_lag_alert_threshold: 300  # seconds (5 minutes)
flasharray_replication_lag_critical_threshold: 900  # seconds (15 minutes)

# Fourth Estate DR configuration
flasharray_dr_site_array: "flasharray-dr-offsite"
flasharray_dr_site_location: "Remote DR Datacenter"

# Fourth Estate protection groups for DR
flasharray_fourth_estate_dr_pgroups:
  - name: "pg-editorial-systems"
    rpo_minutes: 15
    retention_days: 30
  - name: "pg-source-material"
    rpo_minutes: 60
    retention_days: 2555  # 7 years
  - name: "pg-publishing-platform"
    rpo_minutes: 15
    retention_days: 90
  - name: "pg-media-archives"
    rpo_minutes: 360  # 6 hours
    retention_days: 2555

# Compliance and audit
flasharray_replication_audit_logging: true
flasharray_replication_verification: true
flasharray_replication_test_frequency_days: 90  # Test DR every quarter

# Air-gapped replication (for Fourth Estate)
flasharray_airgap_replication: false  # If true, use snapshot shipping
# flasharray_airgap_snapshot_frequency: 86400  # Daily

# Geo-replication
flasharray_geo_replication_enabled: true
flasharray_cross_region_replication: true

# Performance impact
flasharray_replication_performance_impact: "minimal"
flasharray_replication_priority: "high"

# Retention on replica
flasharray_replica_snapshot_retention_days: 30
flasharray_replica_keep_for_days: 30
