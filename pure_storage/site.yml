---
# Pure Storage FlashArray Deployment Playbook
# Entry point for Pure FlashArray automation
#
# Usage:
#   ansible-galaxy collection install -r requirements.yml
#   ansible-playbook -i inventory site.yml --ask-vault-pass

- name: Pure FlashArray Configuration
  hosts: localhost
  connection: local
  gather_facts: true

  vars:
    deploy_install: false
    deploy_config: true
    deploy_hosts: true
    deploy_volumes: true
    deploy_protection: true
    deploy_replication: true
    deploy_performance: true

  tasks:
    - name: Phase 1 - FlashArray Installation
      ansible.builtin.include_role:
        name: pure_flasharray_install
      when: deploy_install | bool
      tags: ['install', 'phase1']

    - name: Phase 2 - FlashArray Configuration
      ansible.builtin.include_role:
        name: pure_flasharray_config
      when: deploy_config | bool
      tags: ['config', 'phase2']

    - name: Phase 3 - Host Configuration
      ansible.builtin.include_role:
        name: pure_flasharray_hosts
      when: deploy_hosts | bool
      tags: ['hosts', 'phase3']

    - name: Phase 4 - Volume Provisioning
      ansible.builtin.include_role:
        name: pure_flasharray_volumes
      when: deploy_volumes | bool
      tags: ['volumes', 'phase4']

    - name: Phase 5 - Data Protection
      ansible.builtin.include_role:
        name: pure_flasharray_protection
      when: deploy_protection | bool
      tags: ['protection', 'phase5']

    - name: Phase 6 - Replication
      ansible.builtin.include_role:
        name: pure_flasharray_replication
      when: deploy_replication | bool
      tags: ['replication', 'phase6']

    - name: Phase 7 - Performance Tuning
      ansible.builtin.include_role:
        name: pure_flasharray_performance
      when: deploy_performance | bool
      tags: ['performance', 'phase7']

    - name: Display summary
      ansible.builtin.debug:
        msg:
          - "=== Pure FlashArray Deployment Complete ==="
          - "Array: {{ pure_array_name | default('Production-FA') }}"
      tags: ['always']
