---
# vars example:
# snap_policies:
#   - pgroup: pg-app01
#     schedule:
#       per_hour: 4
#       per_day: 24
#       per_week: 12
#     retention:
#       keep_for: "30d"
- name: Enforce snapshot schedules on protection groups
  purestorage.flasharray.purefa_pg:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    pgroup: "{{ item.pgroup }}"
    state: present
    # Scheduling knobs vary with collection version; common fields shown below.
    snap: true
    per_hour: "{{ item.schedule.per_hour | default(omit) }}"
    per_day: "{{ item.schedule.per_day | default(omit) }}"
    per_week: "{{ item.schedule.per_week | default(omit) }}"
    per_month: "{{ item.schedule.per_month | default(omit) }}"
    replicate_enabled: "{{ item.schedule.replicate | default(omit) }}"
  loop: "{{ snap_policies | default([]) }}"
  loop_control: { label: "{{ item.pgroup }}" }
