---
# vars example:
# adr_pods:
#   - name: pod-app01
#     target: fa-dr01
#     promote: false
#     demote: false
- name: Configure ActiveDR pod replication
  purestorage.flasharray.purefa_pod:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    pod: "{{ item.name }}"
    target: "{{ item.target }}"
    async: true
    state: present
  loop: "{{ adr_pods | default([]) }}"
  loop_control: { label: "{{ item.name }} -> {{ item.target }}" }

- name: (Optional) Promote pod
  when: item.promote | default(false)
  purestorage.flasharray.purefa_pod:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    pod: "{{ item.name }}"
    promote: true
    state: present
  loop: "{{ adr_pods | default([]) }}"
  loop_control: { label: "promote {{ item.name }}" }

- name: (Optional) Demote pod
  when: item.demote | default(false)
  purestorage.flasharray.purefa_pod:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    pod: "{{ item.name }}"
    demote: true
    state: present
  loop: "{{ adr_pods | default([]) }}"
  loop_control: { label: "demote {{ item.name }}" }
