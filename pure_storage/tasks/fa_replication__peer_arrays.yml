---
# vars example:
# peers:
#   - name: fa-dr01
#     url: "10.0.2.10"
#     api_token: "{{ lookup('env','PURE_FA_DR_TOKEN') }}"
#     type: "iscsi"     # iscsi | fc
- name: Configure replication peers (array connections)
  purestorage.flasharray.purefa_array:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    remote_array: "{{ item.name }}"
    remote_url: "{{ item.url }}"
    remote_api_token: "{{ item.api_token }}"
    transport: "{{ item.type | default(omit) }}"
    state: present
  loop: "{{ peers | default([]) }}"
  loop_control: { label: "{{ item.name }}" }
