# {{ ansible_managed }}
# PostgreSQL Client Authentication Configuration File
# Fourth Estate Production Configuration

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# Local connections
{% for entry in postgresql_hba_entries %}
{% if entry.type == 'local' %}
{{ "%-7s %-15s %-15s %s" | format(entry.type, entry.database, entry.user, entry.auth_method) }}
{% endif %}
{% endfor %}

# IPv4 local connections
{% for entry in postgresql_hba_entries %}
{% if entry.type == 'host' and ':' not in entry.address %}
{{ "%-7s %-15s %-15s %-23s %s" | format(entry.type, entry.database, entry.user, entry.address, entry.auth_method) }}
{% endif %}
{% endfor %}

# IPv6 local connections
{% for entry in postgresql_hba_entries %}
{% if entry.type == 'host' and ':' in entry.address %}
{{ "%-7s %-15s %-15s %-23s %s" | format(entry.type, entry.database, entry.user, entry.address, entry.auth_method) }}
{% endif %}
{% endfor %}

# SSL connections
{% for entry in postgresql_hba_entries %}
{% if entry.type == 'hostssl' %}
{{ "%-7s %-15s %-15s %-23s %s" | format(entry.type, entry.database, entry.user, entry.address, entry.auth_method) }}
{% endif %}
{% endfor %}

# No SSL connections (if explicitly defined)
{% for entry in postgresql_hba_entries %}
{% if entry.type == 'hostnossl' %}
{{ "%-7s %-15s %-15s %-23s %s" | format(entry.type, entry.database, entry.user, entry.address, entry.auth_method) }}
{% endif %}
{% endfor %}
