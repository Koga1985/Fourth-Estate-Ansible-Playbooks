---
- name: Archive audit logs
  ansible.builtin.archive:
    path: "{{ artifacts_dir }}/claroty_audit_*"
    dest: "{{ artifacts_dir }}/claroty_audit_archive_{{ ansible_date_time.iso8601_basic_short }}.tar.gz"
    format: gz

- name: Notify security team of export completion
  community.general.mail:
    host: "localhost"
    from: "claroty@agency.gov"
    to: "{{ notifications.notification_recipients | default(['security@agency.gov']) }}"
    subject: "Claroty xDome Audit Export Complete"
    body: "Audit log export completed successfully. Timestamp: {{ ansible_date_time.iso8601 }}"
  when: notifications.enabled | default(true)
