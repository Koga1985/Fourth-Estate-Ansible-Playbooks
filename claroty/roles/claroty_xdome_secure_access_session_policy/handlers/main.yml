---
# Claroty xDome Session Policy - Handlers

- name: Reload session policies
  ansible.builtin.uri:
    url: "{{ claroty.base_url }}/v1/secure-access/session-policies/reload"
    method: POST
    headers:
      Authorization: "Bearer {{ claroty.token }}"
    status_code: [200, 204]
    validate_certs: "{{ claroty.verify_ssl | default(true) }}"

- name: Notify policy changes
  community.general.mail:
    host: "{{ monitoring.smtp_server | default('localhost') }}"
    port: "{{ monitoring.smtp_port | default(25) }}"
    from: "claroty@agency.gov"
    to: "{{ monitoring.alert_recipients | default(['security@agency.gov']) }}"
    subject: "Claroty xDome - Session Policy Updated"
    body: "Session policies have been updated. Timestamp: {{ ansible_date_time.iso8601 }}"
  when: monitoring.enabled | default(true)
