---
# handlers file for infoblox_dns_config

- name: Restart DNS service
  infoblox.nios_modules.nios_restart:
    restart_option: "RESTART_DNS"
    provider:
      host: "{{ infoblox_grid_master }}"
      username: "{{ infoblox_username }}"
      password: "{{ infoblox_password }}"
      wapi_version: "{{ infoblox_wapi_version }}"
      validate_certs: "{{ infoblox_validate_certs }}"
  listen: "restart dns"

- name: Reload DNS configuration
  infoblox.nios_modules.nios_service_restart:
    service_name: "DNS"
    restart_option: "RELOAD"
    provider:
      host: "{{ infoblox_grid_master }}"
      username: "{{ infoblox_username }}"
      password: "{{ infoblox_password }}"
      wapi_version: "{{ infoblox_wapi_version }}"
      validate_certs: "{{ infoblox_validate_certs }}"
  listen: "reload dns"

- name: Clear DNS cache
  infoblox.nios_modules.nios_dns_cache_clear:
    clear_option: "ALL"
    provider:
      host: "{{ infoblox_grid_master }}"
      username: "{{ infoblox_username }}"
      password: "{{ infoblox_password }}"
      wapi_version: "{{ infoblox_wapi_version }}"
      validate_certs: "{{ infoblox_validate_certs }}"
  listen: "clear dns cache"

- name: Synchronize DNS views
  infoblox.nios_modules.nios_grid_sync:
    sync_option: "SYNC_DNS"
    provider:
      host: "{{ infoblox_grid_master }}"
      username: "{{ infoblox_username }}"
      password: "{{ infoblox_password }}"
      wapi_version: "{{ infoblox_wapi_version }}"
      validate_certs: "{{ infoblox_validate_certs }}"
  listen: "sync dns"

- name: Verify DNSSEC configuration
  infoblox.nios_modules.nios_dnssec_verify:
    verification_option: "VERIFY_ALL_ZONES"
    provider:
      host: "{{ infoblox_grid_master }}"
      username: "{{ infoblox_username }}"
      password: "{{ infoblox_password }}"
      wapi_version: "{{ infoblox_wapi_version }}"
      validate_certs: "{{ infoblox_validate_certs }}"
  listen: "verify dnssec"
