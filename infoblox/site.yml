---
# Infoblox Deployment Playbook
# Entry point for Infoblox DDI automation
#
# Usage:
#   ansible-galaxy collection install -r requirements.yml
#   ansible-playbook -i inventory site.yml --ask-vault-pass

- name: Infoblox Configuration
  hosts: localhost
  connection: local
  gather_facts: true

  vars:
    deploy_grid: true
    deploy_dns: true
    deploy_dhcp: true

  tasks:
    - name: Phase 1 - Grid Configuration
      ansible.builtin.include_role:
        name: infoblox_grid_config
      when: deploy_grid | bool
      tags: ['grid', 'phase1']

    - name: Phase 2 - DNS Configuration
      ansible.builtin.include_role:
        name: infoblox_dns_config
      when: deploy_dns | bool
      tags: ['dns', 'phase2']

    - name: Phase 3 - DHCP Configuration
      ansible.builtin.include_role:
        name: infoblox_dhcp_config
      when: deploy_dhcp | bool
      tags: ['dhcp', 'phase3']

    - name: Display summary
      ansible.builtin.debug:
        msg:
          - "=== Infoblox Deployment Complete ==="
          - "Grid Manager: {{ nios_host }}"
      tags: ['always']
