# NTP configuration for Cohesity node
# Generated by Ansible

driftfile /var/lib/ntp/ntp.drift

# Statistics
statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable

# NTP Servers
{% for ntp_server in cohesity_cluster_ntp_servers %}
server {{ ntp_server }} iburst
{% endfor %}

# Fallback to local clock
server 127.127.1.0
fudge 127.127.1.0 stratum 10

# Access control
restrict -4 default kod notrap nomodify nopeer noquery limited
restrict -6 default kod notrap nomodify nopeer noquery limited
restrict 127.0.0.1
restrict ::1

# Allow NTP client access from local networks
restrict {{ cohesity_cluster_gateway | regex_replace('\\d+$', '0') }} mask 255.255.255.0 nomodify notrap
