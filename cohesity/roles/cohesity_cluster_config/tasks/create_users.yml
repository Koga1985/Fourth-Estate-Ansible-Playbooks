---
# Create local users
- name: Create local user accounts
  ansible.builtin.uri:
    url: "{{ cohesity_api_protocol }}://{{ cohesity_cluster_vip }}/irisservices/api/v1/public/users"
    method: POST
    headers:
      Authorization: "Bearer {{ cohesity_api_token }}"
    body_format: json
    body:
      username: "{{ item.username }}"
      password: "{{ item.password }}"
      emailAddress: "{{ item.email }}"
      roles: "{{ item.roles }}"
      description: "{{ item.description }}"
      domain: "LOCAL"
    validate_certs: "{{ cohesity_api_verify_ssl }}"
    status_code: [200, 201, 409]
  loop: "{{ cohesity_local_users }}"
  loop_control:
    label: "{{ item.username }}"
  no_log: true
