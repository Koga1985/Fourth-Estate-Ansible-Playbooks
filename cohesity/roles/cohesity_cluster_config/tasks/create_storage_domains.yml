---
# Create storage domains
- name: Create storage domains
  ansible.builtin.uri:
    url: "{{ cohesity_api_protocol }}://{{ cohesity_cluster_vip }}/irisservices/api/v1/public/viewBoxes"
    method: POST
    headers:
      Authorization: "Bearer {{ cohesity_api_token }}"
    body_format: json
    body:
      name: "{{ item.name }}"
      compressionPolicy: "{{ item.compression }}"
      deduplicationEnabled: "{{ item.deduplication_enabled }}"
      encryptionPolicy: "{{ item.encryption_policy }}"
      storagePolicy:
        deduplicationEnabled: "{{ item.deduplication_enabled }}"
        compressionEnabled: true
        encryptionEnabled: true
        inlineDeduplicate: "{{ item.inline_dedupe }}"
        inlineCompress: "{{ item.inline_compression }}"
        numFailuresTolerated: "{{ item.num_failures_tolerated }}"
      physicalQuota:
        hardLimitBytes: "{{ item.physical_quota_hard_limit_bytes }}"
    validate_certs: "{{ cohesity_api_verify_ssl }}"
    status_code: [200, 201, 409]
  loop: "{{ cohesity_storage_domains }}"
  loop_control:
    label: "{{ item.name }}"
