---
# Configure LDAP integration
- name: Configure LDAP provider
  ansible.builtin.uri:
    url: "{{ cohesity_api_protocol }}://{{ cohesity_cluster_vip }}/irisservices/api/v1/public/ldapProvider"
    method: POST
    headers:
      Authorization: "Bearer {{ cohesity_api_token }}"
    body_format: json
    body:
      serverUrl: "{{ 'ldaps' if cohesity_ldap_use_ssl else 'ldap' }}://{{ cohesity_ldap_server }}:{{ cohesity_ldap_port }}"
      baseDN: "{{ cohesity_ldap_base_dn }}"
      bindDN: "{{ cohesity_ldap_bind_dn }}"
      bindPassword: "{{ cohesity_ldap_bind_password }}"
      userSearchFilter: "{{ cohesity_ldap_user_search_filter }}"
      groupSearchFilter: "{{ cohesity_ldap_group_search_filter }}"
    validate_certs: "{{ cohesity_api_verify_ssl }}"
    status_code: [200, 201]
  no_log: true
