---
# Configure network interface groups
- name: Create network interface groups
  ansible.builtin.uri:
    url: "{{ cohesity_api_protocol }}://{{ cohesity_cluster_vip }}/irisservices/api/v1/public/vlans"
    method: POST
    headers:
      Authorization: "Bearer {{ cohesity_api_token }}"
    body_format: json
    body:
      ifaceGroupName: "{{ item.name }}"
      vlanId: "{{ item.vlan_id }}"
      subnet:
        ip: "{{ item.subnet.split('/')[0] }}"
        netmaskBits: "{{ item.subnet.split('/')[1] }}"
      gateway: "{{ item.gateway }}"
      mtu: "{{ item.mtu }}"
    validate_certs: "{{ cohesity_api_verify_ssl }}"
    status_code: [200, 201, 409]
  loop: "{{ cohesity_network_interface_groups }}"
  loop_control:
    label: "{{ item.name }}"
