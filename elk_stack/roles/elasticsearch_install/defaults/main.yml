---
# Elasticsearch Installation Defaults

# Elasticsearch version
elasticsearch_version: "8.11.3"
elasticsearch_major_version: "8.x"

# Installation method
elasticsearch_install_method: "package"  # package, archive

# Repository configuration
elasticsearch_use_official_repo: true
elasticsearch_repo_gpg_key: "https://artifacts.elastic.co/GPG-KEY-elasticsearch"

# System configuration
elasticsearch_user: "elasticsearch"
elasticsearch_group: "elasticsearch"
elasticsearch_home: "/usr/share/elasticsearch"
elasticsearch_config_dir: "/etc/elasticsearch"
elasticsearch_data_dir: "/var/lib/elasticsearch"
elasticsearch_log_dir: "/var/log/elasticsearch"
elasticsearch_pid_dir: "/var/run/elasticsearch"

# Additional data paths for multi-disk setups
elasticsearch_data_paths:
  - "{{ elasticsearch_data_dir }}"

# Java/JVM configuration
elasticsearch_java_home: ""  # Auto-detect if empty
elasticsearch_heap_size: "{{ (ansible_memtotal_mb * 0.5) | int | min(32768) }}m"
elasticsearch_heap_size_min: "{{ elasticsearch_heap_size }}"
elasticsearch_heap_size_max: "{{ elasticsearch_heap_size }}"

# JVM options
elasticsearch_jvm_options:
  - "-Xms{{ elasticsearch_heap_size_min }}"
  - "-Xmx{{ elasticsearch_heap_size_max }}"
  - "-XX:+UseG1GC"
  - "-XX:G1ReservePercent=25"
  - "-XX:InitiatingHeapOccupancyPercent=30"
  - "-Djava.io.tmpdir=/var/lib/elasticsearch/tmp"
  - "-XX:+HeapDumpOnOutOfMemoryError"
  - "-XX:HeapDumpPath={{ elasticsearch_data_dir }}"
  - "-XX:ErrorFile={{ elasticsearch_log_dir }}/hs_err_pid%p.log"
  - "-Xlog:gc*,gc+age=trace,safepoint:file={{ elasticsearch_log_dir }}/gc.log:utctime,pid,tags:filecount=32,filesize=64m"

# System limits
elasticsearch_max_open_files: 65536
elasticsearch_max_locked_memory: "unlimited"
elasticsearch_max_map_count: 262144
elasticsearch_max_threads: 4096

# Network configuration
elasticsearch_http_port: 9200
elasticsearch_transport_port: 9300

# Firewall configuration
elasticsearch_configure_firewall: true
elasticsearch_firewall_zone: "public"
elasticsearch_allowed_ips: []  # Empty = allow all

# Service configuration
elasticsearch_service_enabled: true
elasticsearch_service_state: "started"
elasticsearch_restart_on_upgrade: false

# Bootstrap configuration
elasticsearch_perform_bootstrap_checks: true

# Plugin installation
elasticsearch_plugins: []
# Example:
# elasticsearch_plugins:
#   - name: "analysis-icu"
#   - name: "repository-s3"

# Backup directories
elasticsearch_backup_dir: "/var/backups/elasticsearch"
elasticsearch_snapshot_dir: "/mnt/elasticsearch/snapshots"

# Security (basic setup, detailed in elasticsearch_security role)
elasticsearch_security_enabled: true
elasticsearch_security_enrollment_token: ""

# Fourth Estate specific
elasticsearch_fourth_estate_mode: true
elasticsearch_retention_days: 365  # Compliance requirement
elasticsearch_audit_logging: true

# Performance tuning
elasticsearch_disable_swap: true
elasticsearch_bootstrap_memory_lock: true

# Monitoring
elasticsearch_monitoring_enabled: true
elasticsearch_monitoring_collection_interval: "10s"
