---
# Configure IPS update schedule and/or trigger an immediate update.
# Uses the generic API call for broad version compatibility.
#
# Vars:
#   ips_auto_update:
#     enabled: true
#     recurrence: { type: "daily", time: "03:30" }   # or {"type":"hourly"}
#   ips_run_update_now: true|false
#   verify_status: true|false

- name: (Optional) set IPS auto-update schedule
  when: ips_auto_update is defined
  check_point.mgmt.cp_mgmt_api_call:
    command: "set-ips-update-schedule"
    parameters: "{{ ips_auto_update }}"

- name: (Optional) trigger IPS update now
  when: ips_run_update_now | default(false) | bool
  check_point.mgmt.cp_mgmt_api_call:
    command: "run-ips-update"
    parameters: {}

- name: (Optional) verify IPS update status
  when: verify_status | default(true) | bool
  check_point.mgmt.cp_mgmt_api_call:
    command: "show-ips-update-status"
    parameters: {}
  register: _ips_status

- name: Debug IPS status
  when: _ips_status is defined
  ansible.builtin.debug:
    var: _ips_status
