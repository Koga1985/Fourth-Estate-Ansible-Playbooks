---
# Create/Update a Threat Prevention profile with sane defaults.
# Vars:
#   tp_profile_name: "TP-Baseline"
#   tp_profile_desc: "Baseline: recommended protections; Prevent medium+"
#   tp_profile_mode: "optimized"     # or "strict" / "custom"
#   publish_changes: true|false

- name: Create/Update Threat Prevention profile
  check_point.mgmt.cp_mgmt_threat_profile:
    name: "{{ tp_profile_name }}"
    active_protections: "recommended"     # follow Check Point recommendations
    optimize_security_profiles: "{{ (tp_profile_mode | default('optimized')) == 'optimized' }}"
    detect_malicious_mail_content: true
    antivirus: "prevent"
    anti_bot: "prevent"
    ips:
      mode: "prevent"
      performance_impact: "medium_or_lower"     # balance perf / protection
      severity: "medium_or_higher"
    comments: "{{ tp_profile_desc | default(omit) }}"
    state: present

- name: Publish profile changes
  when: publish_changes | default(false) | bool
  check_point.mgmt.cp_mgmt_publish:
