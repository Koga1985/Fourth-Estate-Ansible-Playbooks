
- name: TP rules
  check_point.mgmt.cp_mgmt_threat_rule:
    layer: "{{ tp_layer }}"
    name: "{{ item.name }}"
    position: "{{ item.position | default('top') }}"
    source: "{{ item.source | default(['Any']) }}"
    destination: "{{ item.destination | default(['Any']) }}"
    protected_scope: "{{ item.protected_scope | default(item.destination | default(['Any'])) }}"
    action: "{{ item.action | default('Optimized') }}"
    profile: "{{ item.profile | default(omit) }}"
    install_on: "{{ item.install_on | default(['Policy Targets']) }}"
    enabled: "{{ item.enabled | default(true) }}"
    tags: "{{ item.tags | default(omit) }}"
    state: present
  loop: "{{ tp_rules | default([]) }}"
