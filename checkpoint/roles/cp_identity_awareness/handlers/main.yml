---
# Check Point Identity Awareness Handlers

- name: Publish identity awareness session
  check_point.mgmt.cp_mgmt_publish:
  listen: publish identity awareness

- name: Test identity source connectivity
  check_point.mgmt.cp_mgmt_test_identity_source:
    identity_source: "{{ ia_identity_sources[0].name }}"
  when: ia_identity_sources is defined and ia_identity_sources | length > 0
  listen: test identity source

- name: Refresh identity data
  check_point.mgmt.cp_mgmt_api_call:
    command: "refresh-identity-awareness"
    parameters: {}
  listen: refresh identity data

- name: Verify access role membership
  check_point.mgmt.cp_mgmt_show_access_role:
    name: "{{ item }}"
  loop: "{{ ia_access_roles | map(attribute='name') | list }}"
  when: ia_access_roles is defined
  listen: verify access roles
