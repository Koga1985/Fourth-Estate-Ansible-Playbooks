---
# Check Point Inventory Prune Handlers

- name: Publish cleanup session
  check_point.mgmt.cp_mgmt_publish:
  when: not dry_run | default(true) | bool
  listen: publish cleanup

- name: Generate cleanup report
  ansible.builtin.template:
    src: cleanup_report.j2
    dest: "{{ artifacts_dir | default('/tmp/checkpoint-artifacts') }}/cleanup_report_{{ ansible_date_time.date }}.txt"
    mode: '0640'
  delegate_to: localhost
  listen: generate cleanup report

- name: Backup before cleanup
  check_point.mgmt.cp_mgmt_api_call:
    command: "backup-domain"
    parameters: {}
  when: not dry_run | default(true) | bool
  listen: backup before cleanup
