---
- name: Load allowlist
  ansible.builtin.set_fact:
    allowlist: "{{ lookup('ansible.builtin.file', artifacts_dir | default('/tmp/dragos-artifacts') + '/allowlist.json') | from_json }}"
- name: Render PAN-OS rules template
  ansible.builtin.copy:
    dest: "{{ artifacts_dir | default('/tmp/dragos-artifacts') }}/panos_rules.json"
    mode: "0644"
    content: "{{ {'rules': (allowlist | map('combine', {'action':'allow','from':'any','to':'any'}) | list)} | to_nice_json }}"
