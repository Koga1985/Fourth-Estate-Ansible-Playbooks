---
- name: Load allowlist
  ansible.builtin.set_fact:
    allowlist: "{{ lookup('ansible.builtin.file', artifacts_dir | default('/tmp/dragos-artifacts') + '/allowlist.json') | from_json }}"
- name: Render Check Point rules CSV
  ansible.builtin.copy:
    dest: "{{ artifacts_dir | default('/tmp/dragos-artifacts') }}/checkpoint_rules.csv"
    mode: "0644"
    content: |
      name,source,destination,service,action,track,install-on
      {% for r in allowlist %}
      ALLOW_{{ loop.index }},{{ r.src }},{{ r.dst }},{{ r.service }},Accept,Log,Policy Targets
      {% endfor %}
