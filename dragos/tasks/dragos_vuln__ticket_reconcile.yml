---
# vars: itsm + mapping similar to ticket_create; plus close_transition for Jira or state for SNOW
- name: Load current findings
  ansible.builtin.uri:
    url: "{{ dragos_base_url }}/api/vuln/findings?status=open&limit={{ page_size | default(500) }}"
    method: GET
    headers: { Authorization: "Bearer {{ dragos_token }}" }
    return_content: true
    status_code: 200
    validate_certs: "{{ dragos_verify_ssl | default(true) }}"
  register: _open_now

- name: Determine closed from prior tickets (placeholder)
  ansible.builtin.debug:
    msg: "Compare prior ticket list vs. currently open findings; close tickets whose vuln IDs are absent."

- name: Close ServiceNow incidents (placeholder)
  when: itsm.provider | lower == 'servicenow'
  ansible.builtin.debug:
    msg: "PATCH ServiceNow incidents to state=Resolved/Closed based on mapping."

- name: Transition Jira issues (placeholder)
  when: itsm.provider | lower == 'jira'
  ansible.builtin.debug:
    msg: "POST Jira transition for Done/Resolved where finding no longer open."
