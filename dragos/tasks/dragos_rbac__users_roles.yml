---
# vars: users: [ { username: "svc_ansible", roles: ["reader"], api_token: true } ]
- name: Manage users/roles
  ansible.builtin.uri:
    url: "{{ dragos_base_url }}/api/admin/users"
    method: POST
    headers: { Authorization: "Bearer {{ dragos_token }}", Content-Type: "application/json" }
    body_format: json
    body: "{{ item }}"
    status_code: [200,201,204]
    validate_certs: "{{ dragos_verify_ssl | default(true) }}"
  loop: "{{ users | default([]) }}"
  loop_control: { label: "{{ item.username }}" }
