---
# vars: exceptions: [ { src: "10.1.1.10", dst: "10.2.2.20", service: "tcp/443", expires: "2025-12-31T23:59:59Z" } ]
- name: Register temporary flow exceptions
  ansible.builtin.uri:
    url: "{{ dragos_base_url }}/api/flows/exceptions"
    method: POST
    headers: { Authorization: "Bearer {{ dragos_token }}", Content-Type: "application/json" }
    body_format: json
    body: "{{ item }}"
    status_code: [200,201]
    validate_certs: "{{ dragos_verify_ssl | default(true) }}"
  when: not (dry_run | default(true))
  loop: "{{ exceptions | default([]) }}"
  loop_control: { label: "{{ item.src }}->{{ item.dst }} {{ item.service }}" }
