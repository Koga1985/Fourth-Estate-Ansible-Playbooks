---
# vars: case_id: "abc123", artifacts: [ { path: "/tmp/pcap1.pcap", label: "pcap" } ]
- name: Attach artifacts
  ansible.builtin.uri:
    url: "{{ dragos_base_url }}/api/cases/{{ case_id }}/artifacts"
    method: POST
    headers: { Authorization: "Bearer {{ dragos_token }}" }
    body_format: form-multipart
    body:
      file: "{{ lookup('ansible.builtin.file', item.path) }}"
      label: "{{ item.label | default('evidence') }}"
    status_code: [200,201,202]
    validate_certs: "{{ dragos_verify_ssl | default(true) }}"
  loop: "{{ artifacts | default([]) }}"
  loop_control: { label: "{{ item.path }}" }
