---
# vars examples:
# ioc: { format: "stix", path: "/path/to/indicators.stix" }
# taxii: { url: "https://taxii.server/taxii2", token: "XXX", collection: "ot-indicators" }
- name: Ingest IOCs from file
  when: ioc is defined
  ansible.builtin.uri:
    url: "{{ dragos_base_url }}/api/intel/iocs"
    method: POST
    headers: { Authorization: "Bearer {{ dragos_token }}" }
    body_format: form-multipart
    body:
      file: "{{ lookup('ansible.builtin.file', ioc.path) }}"
      format: "{{ ioc.format | default('stix') }}"
    status_code: [200,201,202]
    validate_certs: "{{ dragos_verify_ssl | default(true) }}"

- name: Ingest IOCs from TAXII (pull then post)
  when: taxii is defined
  ansible.builtin.debug:
    msg: "Pull from TAXII collection {{ taxii.collection }} at {{ taxii.url }}, then POST to Dragos /api/intel/iocs (implement TAXII client step as needed)."
