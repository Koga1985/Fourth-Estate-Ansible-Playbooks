---

- name: Ensure artifacts directory exists
  ansible.builtin.file:
    path: "{{ artifacts_dir }}"
    state: directory
    mode: "0755"

- name: Export audit events
  ansible.builtin.include_tasks: audit_events_export.yml

- name: Export RBAC users/roles
  ansible.builtin.include_tasks: rbac_users_roles.yml

- name: Build least-privilege report
  ansible.builtin.include_tasks: rbac_least_privilege.yml

- name: Bundle compliance pack
  ansible.builtin.include_tasks: audit_compliance_pack.yml

- name: Install governance cron jobs (optional)
  when: cron_jobs | length > 0
  ansible.builtin.include_tasks: scheduler_cron.yml
