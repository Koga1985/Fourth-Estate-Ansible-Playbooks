#!/bin/bash
# SMB Share Configuration Template for VAST Data
# Generated by Ansible for Fourth Estate

# Share: {{ item.name }}
# Path: {{ item.path }}
# Description: {{ item.description }}

cat <<'EOF' | curl -X POST \
  -H "Content-Type: application/json" \
  -u "{{ vast_mgmt_user }}:{{ vast_mgmt_password }}" \
  "https://{{ vast_mgmt_host }}:{{ vast_mgmt_port }}/api/{{ vast_api_version }}/smb/shares" \
  -d @-
{
  "name": "{{ item.name }}",
  "path": "{{ item.path }}",
  "description": "{{ item.description }}",
  "enabled": {{ item.enabled | lower }},
  "browsable": {{ item.browsable | lower }},
  "access_based_enumeration": {{ item.access_based_enumeration | lower }},
  "permissions": [
    {% for perm in item.permissions %}
    {
      "principal": "{{ perm.principal }}",
      "type": "{{ perm.type }}",
      "access": "{{ perm.access }}"
    }{{ "," if not loop.last else "" }}
    {% endfor %}
  ]
}
EOF
