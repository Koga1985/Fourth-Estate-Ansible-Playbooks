#!/bin/bash
# S3 Bucket Configuration Template for VAST Data
# Generated by Ansible for Fourth Estate

# Bucket: {{ item.name }}

cat <<'EOF' | curl -X POST \
  -H "Content-Type: application/json" \
  -u "{{ vast_mgmt_user }}:{{ vast_mgmt_password }}" \
  "https://{{ vast_mgmt_host }}:{{ vast_mgmt_port }}/api/{{ vast_api_version }}/s3/buckets" \
  -d @-
{
  "name": "{{ item.name }}",
  "versioning_enabled": {{ item.versioning_enabled | lower }},
  "encryption_enabled": {{ item.encryption_enabled | lower }},
  "lifecycle_policy": "{{ item.lifecycle_policy }}"
}
EOF
