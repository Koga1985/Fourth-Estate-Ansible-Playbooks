---
- name: Create or update SL1 organizations
  ansible.builtin.uri:
    url: "{{ sl1.url }}/api/organization"
    method: POST
    body:
      company: "{{ item.name }}"
      description: "{{ item.description }}"
      billing_id: "{{ item.billing_id }}"
      parent: "{{ item.parent_org }}"
      contact_email: "{{ item.contact_email }}"
      theme: "{{ item.theme }}"
    body_format: json
    headers:
      Content-Type: "application/json"
      X-EM7-API-Username: "{{ sl1.api_user }}"
      X-EM7-API-Password: "{{ sl1.api_password }}"
    validate_certs: "{{ sl1.verify_ssl }}"
    status_code: [200, 201, 409]
  loop: "{{ sl1_organizations }}"
  when: not dry_run

- name: Organizations configuration summary
  ansible.builtin.debug:
    msg:
      - "Configured {{ sl1_organizations | length }} organizations"
      - "Organizations: {{ sl1_organizations | map(attribute='name') | join(', ') }}"
