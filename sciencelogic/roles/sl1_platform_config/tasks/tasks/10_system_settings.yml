---
- name: Configure system settings via API
  ansible.builtin.uri:
    url: "{{ sl1. }}/api/system/settings"
    method: PUT
    body:
      company_name: "{{ sl1_system_settings.company_name }}"
      system_name: "{{ sl1_system_settings.system_name }}"
      session_timeout: "{{ sl1_system_settings.session_timeout }}"
      login_banner: "{{ sl1_system_settings.login_banner }}"
      enable_audit_log: "{{ sl1_system_settings.enable_audit_log }}"
      log_level: "{{ sl1_system_settings.log_level }}"
      max_concurrent_users: "{{ sl1_system_settings.max_concurrent_users }}"
    body_format: json
    headers:
      Content-Type: "application/json"
      X-EM7-API-Username: "{{ sl1.api_user }}"
      X-EM7-API-Password: "{{ sl1.api_password }}"
    validate_certs: "{{ sl1.verify_ssl }}"
    status_code: [200, 201]
  register: system_settings_result
  when: not dry_run

- name: Configure password policy
  ansible.builtin.uri:
    url: "{{ sl1.url }}/api/account/password_policy"
    method: PUT
    body: "{{ sl1_system_settings.password_policy }}"
    body_format: json
    headers:
      Content-Type: "application/json"
      X-EM7-API-Username: "{{ sl1.api_user }}"
      X-EM7-API-Password: "{{ sl1.api_password }}"
    validate_certs: "{{ sl1.verify_ssl }}"
    status_code: [200, 201]
  when: not dry_run

- name: System settings configuration summary
  ansible.builtin.debug:
    msg:
      - "System settings configured"
      - "Company: {{ sl1_system_settings.company_name }}"
      - "Session Timeout: {{ sl1_system_settings.session_timeout }} minutes"
