---
- name: Configure backup settings
  ansible.builtin.uri:
    url: "{{ sl1.url }}/api/system/backup"
    method: PUT
    body:
      enabled: "{{ sl1_backup.enabled }}"
      schedule: "{{ sl1_backup.schedule }}"
      retention_days: "{{ sl1_backup.retention_days }}"
      backup_path: "{{ sl1_backup.backup_path }}"
      include_database: "{{ sl1_backup.include_database }}"
      include_config: "{{ sl1_backup.include_config }}"
      include_logs: "{{ sl1_backup.include_logs }}"
      compress: "{{ sl1_backup.compress }}"
    body_format: json
    headers:
      Content-Type: "application/json"
      X-EM7-API-Username: "{{ sl1.api_user }}"
      X-EM7-API-Password: "{{ sl1.api_password }}"
    validate_certs: "{{ sl1.verify_ssl }}"
    status_code: [200, 201]
  when: not dry_run
