---
- name: Configure database maintenance schedule
  ansible.builtin.uri:
    url: "{{ sl1.url }}/api/system/database/maintenance"
    method: PUT
    body:
      optimize_tables: "{{ sl1_database_maintenance.optimize_tables }}"
      optimize_schedule: "{{ sl1_database_maintenance.optimize_schedule }}"
      vacuum_analyze: "{{ sl1_database_maintenance.vacuum_analyze }}"
      reindex: "{{ sl1_database_maintenance.reindex }}"
      statistics_update: "{{ sl1_database_maintenance.statistics_update }}"
      backup_before_maintenance: "{{ sl1_database_maintenance.backup_before_maintenance }}"
    body_format: json
    headers:
      Content-Type: "application/json"
      X-EM7-API-Username: "{{ sl1.api_user }}"
      X-EM7-API-Password: "{{ sl1.api_password }}"
    validate_certs: "{{ sl1.verify_ssl }}"
    status_code: [200, 201]
  when: not dry_run
