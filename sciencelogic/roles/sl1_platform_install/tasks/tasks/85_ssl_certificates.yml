---
- name: Copy SSL certificate
  ansible.builtin.copy:
    src: "{{ sl1_ssl.certificate_path }}"
    dest: /opt/em7/conf/ssl/em7.crt
    owner: em7admin
    group: em7admin
    mode: '0644'
  when: not dry_run
  notify: Restart SL1 services

- name: Copy SSL private key
  ansible.builtin.copy:
    src: "{{ sl1_ssl.private_key_path }}"
    dest: /opt/em7/conf/ssl/em7.key
    owner: em7admin
    group: em7admin
    mode: '0600'
  when: not dry_run
  notify: Restart SL1 services

- name: Copy CA bundle
  ansible.builtin.copy:
    src: "{{ sl1_ssl.ca_bundle_path }}"
    dest: /opt/em7/conf/ssl/ca-bundle.crt
    owner: em7admin
    group: em7admin
    mode: '0644'
  when:
    - sl1_ssl.ca_bundle_path is defined
    - not dry_run
  notify: Restart SL1 services

- name: Configure TLS version
  ansible.builtin.lineinfile:
    path: /opt/em7/conf/em7.conf
    regexp: '^ssl_protocols'
    line: "ssl_protocols = TLSv{{ sl1_ssl.tls_version }}"
  when: not dry_run
  notify: Restart SL1 services
