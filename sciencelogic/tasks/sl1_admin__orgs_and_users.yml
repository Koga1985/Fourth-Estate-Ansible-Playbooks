
---
# create/update Organizations, users, SAML/SSO roles.
- name: Ensure artifacts dir
  ansible.builtin.file:
    path: "{{ artifacts_dir | default('/tmp/sl1-artifacts') }}"
    state: directory
    mode: "0755"

- name: Validate inputs
  ansible.builtin.assert:
    that: [ (orgs | default([])) is iterable, (users | default([])) is iterable ]
    fail_msg: "Provide orgs:[] and users:[]"
- name: Upsert organizations (placeholder)
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/orgs_desired.json"
    mode: "0644"
    content: "{{ orgs | default([]) | to_nice_json }}"
- name: Upsert users (placeholder)
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/users_desired.json"
    mode: "0644"
    content: "{{ users | default([]) | to_nice_json }}"
- name: SSO roles map (optional)
  when: sso_roles is defined
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/sso_roles.json"
    mode: "0644"
    content: "{{ sso_roles | to_nice_json }}"
