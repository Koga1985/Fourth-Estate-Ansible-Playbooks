---
# SentinelOne Agent Configuration

- name: Set log level (Linux)
  ansible.builtin.command: >
    /opt/sentinelone/bin/sentinelctl config log.level {{ s1_agent_log_level }}
  when: ansible_os_family in ['RedHat', 'Debian', 'Suse']
  changed_when: true

- name: Enable self-protection (Linux)
  ansible.builtin.command: >
    /opt/sentinelone/bin/sentinelctl config agent.self-protection {{ 'on' if s1_self_protection else 'off' }}
  when: ansible_os_family in ['RedHat', 'Debian', 'Suse']
  changed_when: true

- name: Configure Deep Visibility (Linux)
  ansible.builtin.command: >
    /opt/sentinelone/bin/sentinelctl config agent.deep-visibility {{ 'on' if s1_enable_deep_visibility else 'off' }}
  when: ansible_os_family in ['RedHat', 'Debian', 'Suse']
  changed_when: true
  failed_when: false

- name: Display configuration status
  ansible.builtin.debug:
    msg: "SentinelOne agent configured successfully"
