---
# SentinelOne Agent Installation Test
# Validates agent installation and configuration

- name: Test SentinelOne Agent Installation
  hosts: localhost
  gather_facts: true
  connection: local

  vars:
    s1_site_token: "test-token-12345"
    s1_console_url: "https://usgoveast1.sentinelone.net"

  tasks:
    - name: Test - Validate agent installation prerequisites
      ansible.builtin.assert:
        that:
          - s1_site_token is defined
          - s1_console_url is defined
        success_msg: "✓ Prerequisites validated"
        fail_msg: "✗ Prerequisites validation failed"

    - name: Test - Check if sentinelctl command would exist
      ansible.builtin.debug:
        msg: "Would check for /opt/sentinelone/bin/sentinelctl existence"

    - name: Test - Verify agent configuration variables
      ansible.builtin.assert:
        that:
          - s1_site_token | length > 0
          - s1_console_url | length > 0
          - "'sentinelone.net' in s1_console_url"
        success_msg: "✓ Configuration variables valid"

    - name: Test - Simulate agent health check
      ansible.builtin.debug:
        msg: "Would execute: /opt/sentinelone/bin/sentinelctl status"

    - name: Test Summary
      ansible.builtin.debug:
        msg:
          - "================================"
          - "SentinelOne Agent Installation Test"
          - "✓ All tests passed"
          - "================================"
