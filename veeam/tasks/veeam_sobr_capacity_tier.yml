---
# Inputs: sobr_id, capacity_extents (array), tier_after_days
- name: Patch SOBR to enable capacity tier
  ansible.builtin.uri:
    url: "{{ veeam_base_url }}/api/v1/backupInfrastructure/scaleOutRepositories/{{ sobr_id }}"
    method: PATCH
    headers:
      Authorization: "Bearer {{ veeam_token }}"
      Content-Type: "application/json"
    body_format: json
    body:
      capacityTier:
        enabled: true
        extents: "{{ capacity_extents }}"
        movePolicy:
          operationalRestoreWindowDays: "{{ tier_after_days | default(30) }}"
    status_code: [200]
    validate_certs: "{{ veeam_verify_tls }}"
