---
# Inputs: source_vm_id, restore_point_id, target_vm_name, target_datastore_id, target_network_id

- name: Start Instant Recovery
  ansible.builtin.uri:
    url: "{{ veeam_base_url }}/api/v1/restoreSessions/instantVmRecovery"
    method: POST
    headers:
      Authorization: "Bearer {{ veeam_token }}"
      Content-Type: "application/json"
    body_format: json
    body:
      sourceVmObjectId: "{{ source_vm_id }}"
      restorePointId: "{{ restore_point_id }}"
      targetVmName: "{{ target_vm_name }}"
      powerOn: true
      network:
        type: "Custom"
        targetNetworkId: "{{ target_network_id }}"
      datastoreId: "{{ target_datastore_id }}"
    status_code: [200,202]
    validate_certs: "{{ veeam_verify_tls }}"
  register: ir
