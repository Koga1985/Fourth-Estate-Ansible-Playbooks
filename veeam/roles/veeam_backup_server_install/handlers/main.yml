---
# handlers file for veeam_backup_server_install

- name: Restart Veeam Backup Service
  ansible.windows.win_service:
    name: VeeamBackupSvc
    state: restarted

- name: Restart Veeam Broker Service
  ansible.windows.win_service:
    name: VeeamBrokerSvc
    state: restarted

- name: Restart Veeam Catalog Service
  ansible.windows.win_service:
    name: VeeamCatalogSvc
    state: restarted

- name: Restart Veeam Cloud Service
  ansible.windows.win_service:
    name: VeeamCloudSvc
    state: restarted

- name: Restart Veeam Enterprise Manager
  ansible.windows.win_service:
    name: VeeamEnterpriseManagerSvc
    state: restarted

- name: Restart Veeam Mount Service
  ansible.windows.win_service:
    name: VeeamMountSvc
    state: restarted

- name: Restart Veeam REST Service
  ansible.windows.win_service:
    name: VeeamRESTSvc
    state: restarted

- name: Restart all Veeam services
  ansible.windows.win_shell: |
    $services = @(
      "VeeamBackupSvc",
      "VeeamBrokerSvc",
      "VeeamCatalogSvc",
      "VeeamCloudSvc",
      "VeeamEnterpriseManagerSvc",
      "VeeamMountSvc",
      "VeeamRESTSvc"
    )

    foreach ($svc in $services) {
      $service = Get-Service $svc -ErrorAction SilentlyContinue
      if ($service -and $service.Status -eq "Running") {
        Restart-Service $svc -Force
        Write-Output "Restarted $svc"
      }
    }
