---
# Audit events, role reviews, rule diffs â†’ ZIP.
- name: Ensure artifacts dir
  ansible.builtin.file:
    path: "{{ artifacts_dir | default('/tmp/ot-artifacts') }}"
    state: directory
    mode: "0755"

- name: Collect components (placeholders)
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/role_reviews.csv"
    mode: "0644"
    content: "user,role,scope,last_seen\n"
- name: Rule diffs
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/rule_diffs.csv"
    mode: "0644"
    content: "device,rule,change,when\n"
- name: Bundle ZIP
  ansible.builtin.shell: |
    set -e
    cd "{{ artifacts_dir }}"
    zip -r compliance_62443_bundle.zip role_reviews.csv rule_diffs.csv >/dev/null 2>&1 || true
  args: { executable: /bin/bash }
  changed_when: false
