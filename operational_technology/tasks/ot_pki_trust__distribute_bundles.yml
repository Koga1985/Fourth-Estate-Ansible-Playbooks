---
# Copy trust bundles/certs (guarded).
- name: Ensure artifacts dir
  ansible.builtin.file:
    path: "{{ artifacts_dir | default('/tmp/ot-artifacts') }}"
    state: directory
    mode: "0755"

- name: Guard distribution (dry-run by default)
  ansible.builtin.assert:
    that: [ not (dry_run | default(true) | bool) ]
    fail_msg: "dry_run=true â€” distribution is read-only. Set dry_run=false to copy bundles."

- name: Distribute trust bundles/certs
  ansible.builtin.copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: "{{ item.mode | default('0644') }}"
  loop: "{{ trust_bundles | default([]) }}"
