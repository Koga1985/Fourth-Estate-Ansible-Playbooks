---
# Batch + retry to HEC.
- name: Ensure artifacts dir
  ansible.builtin.file:
    path: "{{ artifacts_dir | default('/tmp/ot-artifacts') }}"
    state: directory
    mode: "0755"

- name: Guard HEC config
  ansible.builtin.assert:
    that: [ hec.url is defined, hec.token is defined ]
    fail_msg: "hec.url and hec.token required."

- name: Forward alerts to HEC (placeholder batch)
  ansible.builtin.uri:
    url: "{{ hec.url }}"
    method: POST
    headers:
      Authorization: "Splunk {{ hec.token }}"
      Content-Type: "application/json"
    body_format: json
    body:
      events: "{{ alerts | default([]) }}"
    status_code: 200,201,202
