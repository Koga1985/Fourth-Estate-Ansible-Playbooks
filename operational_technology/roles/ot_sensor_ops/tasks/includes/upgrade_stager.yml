---
- name: Ensure artifacts dir
  ansible.builtin.file:
    path: "{{ artifacts_dir | default('/tmp/ot-artifacts') }}"
    state: directory
    mode: "0755"

- name: Pre-checks before upgrade
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/sensors_upgrade_precheck.txt"
    mode: "0644"
    content: "Disk/CPU/Net prechecks OK (placeholder)."
- name: Perform staged upgrade (guarded)
  when: not (dry_run | default(true) | bool)
  ansible.builtin.debug:
    msg: "Would perform upgrade actions per vendor API."
- name: Post-checks after upgrade
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/sensors_upgrade_postcheck.txt"
    mode: "0644"
    content: "Post-upgrade health look good (placeholder)."
