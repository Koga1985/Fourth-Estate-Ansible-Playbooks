---
- name: Ensure artifacts dir
  ansible.builtin.file:
    path: "{{ artifacts_dir | default('/tmp/ot-artifacts') }}"
    state: directory
    mode: "0755"

- name: Coverage stats
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/coverage_report.csv"
    mode: "0644"
    content: |
      metric,value
      total,{{ _assets.json | length | default(0) }}
      with_site_zone,{{ (_assets.json | selectattr('labels.site','defined') | selectattr('labels.zone','defined') | list | length) | default(0) }}
