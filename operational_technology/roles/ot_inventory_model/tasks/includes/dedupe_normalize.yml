---
- name: Ensure artifacts dir
  ansible.builtin.file:
    path: "{{ artifacts_dir | default('/tmp/ot-artifacts') }}"
    state: directory
    mode: "0755"

- name: Normalize â†’ CSV
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/inventory_normalized.csv"
    mode: "0644"
    content: |
      hostname,ip,site,zone,criticality,owner
      {% for a in _assets.json | default([]) %}
      {{ a.hostname | default(a.name | default('')) }},{{ a.ip | default(a.primaryIp | default('')) }},{{ a.labels.site | default('') }},{{ a.labels.zone | default('') }},{{ a.labels.criticality | default('') }},{{ a.labels.owner | default('') }}
      {% endfor %}
