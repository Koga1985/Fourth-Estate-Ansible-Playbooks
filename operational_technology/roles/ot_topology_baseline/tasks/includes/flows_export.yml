---
- name: Ensure artifacts dir
  ansible.builtin.file:
    path: "{{ artifacts_dir | default('/tmp/ot-artifacts') }}"
    state: directory
    mode: "0755"

- name: Pull flows
  ansible.builtin.uri:
    url: "{{ api.url }}{{ api.paths.flows | default('/flows') }}"
    method: GET
    headers: { "Authorization": "{{ api.token }}" }
    validate_certs: "{{ verify_ssl | default(true) }}"
    return_content: true
  register: _flows
- name: Save flows
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/flows.json"
    mode: "0644"
    content: "{{ _flows.json | to_nice_json }}"
