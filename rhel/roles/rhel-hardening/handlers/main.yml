---
# handlers/main.yml - Service restart handlers
# RHEL System Hardening Role

- name: restart sshd
  ansible.builtin.systemd:
    name: sshd
    state: restarted
  listen: restart sshd

- name: restart chronyd
  ansible.builtin.systemd:
    name: chronyd
    state: restarted
  listen: restart chronyd

- name: restart auditd
  ansible.builtin.service:
    name: auditd
    state: restarted
  listen: restart auditd

- name: restart rsyslog
  ansible.builtin.systemd:
    name: rsyslog
    state: restarted
  listen: restart rsyslog

- name: reload firewalld
  ansible.builtin.systemd:
    name: firewalld
    state: reloaded
  listen: reload firewalld

- name: reload systemd
  ansible.builtin.systemd:
    daemon_reload: true
  listen: reload systemd

- name: reboot system
  ansible.builtin.debug:
    msg: "System reboot is required. Please reboot manually or run with --tags reboot"
  listen: reboot system

- name: reboot if required
  ansible.builtin.reboot:
    reboot_timeout: 600
    pre_reboot_delay: 10
    post_reboot_delay: 30
    test_command: uptime
  when: rhel_auto_reboot | default(false) | bool
  listen: reboot if required
