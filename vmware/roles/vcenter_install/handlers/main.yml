---
# handlers/main.yml - vCenter Server Installation

- name: restart vcenter services
  ansible.builtin.uri:
    url: "https://{{ vcenter_hostname }}/api/appliance/services/restart"
    method: POST
    user: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    force_basic_auth: true
    validate_certs: "{{ vcenter_validate_certs }}"
    headers:
      Content-Type: "application/json"
  delegate_to: localhost
  listen: "restart vcenter"

- name: verify vcenter accessibility
  community.vmware.vmware_about_info:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: "{{ vcenter_validate_certs }}"
  register: vcenter_verify
  until: vcenter_verify is success
  retries: 12
  delay: 10
  delegate_to: localhost
  listen: "verify vcenter"
