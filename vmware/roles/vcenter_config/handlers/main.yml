---
# handlers/main.yml - vCenter Configuration Handlers

- name: restart vpxd service
  ansible.builtin.uri:
    url: "https://{{ vcenter_hostname }}/api/appliance/services/vpxd/restart"
    method: POST
    user: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    force_basic_auth: true
    validate_certs: "{{ vcenter_validate_certs }}"
    headers:
      Content-Type: "application/json"
  delegate_to: localhost
  listen: "restart vcenter services"

- name: verify vcenter services
  community.vmware.vmware_about_info:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: "{{ vcenter_validate_certs }}"
  register: vcenter_verify
  until: vcenter_verify is success
  retries: 10
  delay: 15
  delegate_to: localhost
  listen: "verify vcenter"
