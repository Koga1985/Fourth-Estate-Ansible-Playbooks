---
# CrowdStrike Falcon Fourth Estate Configuration

- name: Apply Fourth Estate sensor tags
  ansible.builtin.command: >
    /opt/CrowdStrike/falconctl -s --tags=Fourth-Estate,Source-Protection,Journalist-Workstation
  when:
    - ansible_os_family in ['RedHat', 'Debian', 'Suse']
    - falcon_source_protection | bool
  changed_when: true

- name: Enable enhanced logging for Fourth Estate
  ansible.builtin.command: /opt/CrowdStrike/falconctl -s --trace=info
  when:
    - ansible_os_family in ['RedHat', 'Debian', 'Suse']
    - falcon_enhanced_logging | bool
  changed_when: true

- name: Configure STIG compliance mode
  ansible.builtin.command: /opt/CrowdStrike/falconctl -s --feature=stig-compliance --enable=true
  when:
    - ansible_os_family in ['RedHat', 'Debian', 'Suse']
    - falcon_stig_mode | bool
  changed_when: true
  failed_when: false

- name: Display Fourth Estate configuration
  ansible.builtin.debug:
    msg: "Fourth Estate specific Falcon configuration applied"
