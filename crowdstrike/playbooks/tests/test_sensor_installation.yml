---
# CrowdStrike Falcon Sensor Installation Test
# Validates sensor installation and configuration

- name: Test CrowdStrike Falcon Sensor Installation
  hosts: localhost
  gather_facts: true
  connection: local

  vars:
    falcon_cid: "test-cid-12345"
    falcon_installation_token: "test-token"
    falcon_cloud: "us-gov-1"

  tasks:
    - name: Test - Validate sensor installation prerequisites
      ansible.builtin.assert:
        that:
          - falcon_cid is defined
          - falcon_cloud is defined
        success_msg: "✓ Prerequisites validated"
        fail_msg: "✗ Prerequisites validation failed"

    - name: Test - Check if falconctl command would exist
      ansible.builtin.debug:
        msg: "Would check for /opt/CrowdStrike/falconctl existence"

    - name: Test - Verify sensor configuration variables
      ansible.builtin.assert:
        that:
          - falcon_cid | length > 0
          - falcon_cloud in ['us-1', 'us-2', 'eu-1', 'us-gov-1']
        success_msg: "✓ Configuration variables valid"

    - name: Test - Simulate sensor health check
      ansible.builtin.debug:
        msg: "Would execute: /opt/CrowdStrike/falconctl -g --aid"

    - name: Test Summary
      ansible.builtin.debug:
        msg:
          - "================================"
          - "CrowdStrike Sensor Installation Test"
          - "✓ All tests passed"
          - "================================"
