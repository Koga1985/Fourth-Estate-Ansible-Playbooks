---
# defaults file for splunk_enterprise_install
# DoD STIG and NIST 800-53 Compliant Splunk Enterprise Installation

# Splunk Version and Package
splunk_version: "9.2.1"
splunk_build: "78803f08aabb"
splunk_product: "splunk"  # Options: splunk, splunkforwarder
splunk_architecture: "x86_64"
splunk_package_url: "{{ vault_splunk_package_url | default('https://download.splunk.com/products/splunk/releases') }}"

# Installation Paths (STIG V-258000)
splunk_home: "/opt/splunk"
splunk_db: "/opt/splunk/var/lib/splunk"
splunk_user: "splunk"
splunk_group: "splunk"
splunk_user_uid: 1500
splunk_group_gid: 1500
splunk_user_shell: "/bin/bash"

# System Requirements Validation
splunk_min_memory_gb: 12
splunk_min_disk_gb: 500
splunk_validate_requirements: true

# License Configuration (STIG V-258002)
splunk_accept_license: false  # Must be explicitly set to true
splunk_license_file: "{{ vault_splunk_license_file | default('') }}"
splunk_license_master: "{{ vault_splunk_license_master | default('') }}"

# Network Configuration (NIST 800-53 SC-7)
splunk_web_port: 8000
splunk_mgmt_port: 8089
splunk_splunktcp_port: 9997
splunk_kvstore_port: 8191
splunk_appserver_port: 8065
splunk_bind_ip: "0.0.0.0"  # Should be restricted in production
splunk_enable_web_ssl: true
splunk_enable_splunktcp_ssl: true

# Admin Account Configuration (STIG V-258004, NIST 800-53 IA-2)
splunk_admin_password: "{{ vault_splunk_admin_password }}"
splunk_admin_password_min_length: 15
splunk_require_password_change_on_first_login: true

# FIPS Mode (NIST 800-53 SC-13, STIG V-258006)
splunk_enable_fips: true
splunk_fips_mode: "strict"

# TLS Configuration (NIST 800-52r2, STIG V-258008)
splunk_tls_min_version: "tls1.2"
splunk_ssl_versions: "tls1.2, tls1.3"
splunk_cipher_suite: "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256"
splunk_ecdh_curves: "prime256v1, secp384r1, secp521r1"
splunk_use_default_tls_certs: false
splunk_server_cert: "{{ vault_splunk_server_cert | default('') }}"
splunk_server_key: "{{ vault_splunk_server_key | default('') }}"
splunk_ca_cert: "{{ vault_splunk_ca_cert | default('') }}"

# Authentication (NIST 800-63B, STIG V-258010)
splunk_auth_type: "LDAP"  # Options: Splunk, LDAP, SAML
splunk_ldap_host: "{{ vault_ldap_host | default('') }}"
splunk_ldap_port: 636  # LDAPS
splunk_ldap_ssl_enabled: true
splunk_ldap_bind_dn: "{{ vault_ldap_bind_dn | default('') }}"
splunk_ldap_bind_password: "{{ vault_ldap_bind_password | default('') }}"
splunk_ldap_user_base_dn: "{{ vault_ldap_user_base_dn | default('') }}"
splunk_ldap_group_base_dn: "{{ vault_ldap_group_base_dn | default('') }}"

# Multi-Factor Authentication (NIST 800-53 IA-2(1), STIG V-258012)
splunk_enable_mfa: true
splunk_mfa_type: "DUO"  # Options: DUO, RSA, RADIUS

# Session Management (STIG V-258014)
splunk_ui_session_timeout: 900  # 15 minutes
splunk_ui_idle_timeout: 600     # 10 minutes
splunk_max_concurrent_sessions: 3
splunk_enable_csrf_protection: true

# File System Permissions (STIG V-258016)
splunk_enforce_strict_permissions: true
splunk_file_mode: "0600"
splunk_dir_mode: "0700"
splunk_config_mode: "0600"

# Audit and Logging (NIST 800-53 AU family, STIG V-258018)
splunk_audit_all_searches: true
splunk_audit_admin_actions: true
splunk_audit_failed_logins: true
splunk_log_retention_days: 365
splunk_enable_audit_trail: true
splunk_audit_log_path: "{{ splunk_home }}/var/log/splunk/audit.log"

# Indexer Settings (NIST 800-53 AU-11)
splunk_max_data_size: "auto_high_volume"
splunk_max_hot_buckets: 10
splunk_max_warm_db_count: 300
splunk_frozen_time_period_in_secs: 31536000  # 1 year
splunk_index_replication_factor: 3
splunk_index_search_factor: 2

# Deployment Server (if applicable)
splunk_deployment_server: "{{ vault_splunk_deployment_server | default('') }}"
splunk_deployment_client_name: "{{ inventory_hostname }}"

# Clustering Configuration
splunk_cluster_mode: "none"  # Options: none, master, peer, searchhead
splunk_cluster_master_uri: "{{ vault_splunk_cluster_master_uri | default('') }}"
splunk_cluster_label: "{{ vault_splunk_cluster_label | default('production') }}"
splunk_cluster_secret: "{{ vault_splunk_cluster_secret }}"

# Search Head Clustering
splunk_shc_mode: false
splunk_shc_captain_uri: "{{ vault_splunk_shc_captain_uri | default('') }}"
splunk_shc_label: "{{ vault_splunk_shc_label | default('sh_cluster') }}"
splunk_shc_secret: "{{ vault_splunk_shc_secret }}"
splunk_shc_replication_factor: 3

# Monitoring and Health
splunk_enable_monitoring_console: true
splunk_health_report_enabled: true
splunk_health_report_schedule: "0 1 * * *"  # Daily at 1 AM

# Resource Usage Limits (STIG V-258020)
splunk_max_searches_per_cpu: 1
splunk_max_concurrent_searches: 6
splunk_search_process_memory_limit: 4096  # MB
splunk_max_upload_size: 1024  # MB

# Software Updates (STIG V-258022)
splunk_check_for_updates: false  # Manual updates in production
splunk_send_usage_data: false    # Privacy requirement

# SELinux Configuration (STIG V-258024)
splunk_selinux_enabled: true
splunk_selinux_mode: "enforcing"

# Firewall Configuration (NIST 800-53 SC-7)
splunk_configure_firewall: true
splunk_allowed_management_networks:
  - "10.0.0.0/8"
  - "172.16.0.0/12"
  - "192.168.0.0/16"

# Backup Configuration (NIST 800-53 CP-9)
splunk_enable_backup: true
splunk_backup_path: "/backup/splunk"
splunk_backup_schedule: "0 2 * * 0"  # Weekly at 2 AM on Sunday
splunk_backup_retention_days: 90

# Certificate Management (STIG V-258026)
splunk_use_dod_pki_certificates: true
splunk_cert_validation_strict: true
splunk_cert_expiry_warning_days: 30
splunk_intermediate_ca_certs: []

# Compliance Frameworks
splunk_compliance_frameworks:
  - "dod_stig"
  - "nist_800_53"
  - "nist_800_171"
  - "fisma"

# Banner Configuration (STIG V-258028)
splunk_login_banner_enabled: true
splunk_login_banner_text: |
  You are accessing a U.S. Government (USG) Information System (IS) that is provided for USG-authorized use only.
  By using this IS (which includes any device attached to this IS), you consent to the following conditions:
  - The USG routinely intercepts and monitors communications on this IS for purposes including, but not limited to,
    penetration testing, COMSEC monitoring, network operations and defense, personnel misconduct (PM), law enforcement (LE),
    and counterintelligence (CI) investigations.
  - At any time, the USG may inspect and seize data stored on this IS.
  - Communications using, or data stored on, this IS are not private, are subject to routine monitoring,
    interception, and search, and may be disclosed or used for any USG-authorized purpose.
  - This IS includes security measures (e.g., authentication and access controls) to protect USG interests--not
    for your personal benefit or privacy.
  - Notwithstanding the above, using this IS does not constitute consent to PM, LE or CI investigative searching
    or monitoring of the content of privileged communications, or work product, related to personal representation
    or services by attorneys, psychotherapists, or clergy, and their assistants. Such communications and work
    product are private and confidential. See User Agreement for details.

# Service Management
splunk_enable_boot_start: true
splunk_restart_on_config_change: false  # Manual restart in production

# Pre-installation Checks
splunk_perform_preinstall_checks: true
splunk_check_disk_space: true
splunk_check_memory: true
splunk_check_network_ports: true
splunk_check_os_compatibility: true

# Supported Operating Systems
splunk_supported_os_families:
  - RedHat
  - CentOS
  - Rocky
  - AlmaLinux
  - Ubuntu
  - Debian

# Installation Method
splunk_install_method: "package"  # Options: package, archive
splunk_cleanup_installer: true
splunk_verify_checksum: true
