---
# tasks file for splunk_enterprise_install
# DoD STIG and NIST 800-53 Compliant Splunk Installation

- name: Include pre-installation validation tasks
  ansible.builtin.include_tasks: preinstall_checks.yml
  tags:
    - splunk
    - preinstall
    - validation

- name: Include system preparation tasks
  ansible.builtin.include_tasks: system_prep.yml
  tags:
    - splunk
    - system
    - preparation

- name: Include Splunk package installation tasks
  ansible.builtin.include_tasks: install_package.yml
  tags:
    - splunk
    - install
    - package

- name: Include initial configuration tasks
  ansible.builtin.include_tasks: initial_config.yml
  tags:
    - splunk
    - config
    - initial

- name: Include FIPS configuration tasks
  ansible.builtin.include_tasks: fips_config.yml
  when: splunk_enable_fips | bool
  tags:
    - splunk
    - fips
    - security

- name: Include TLS/SSL configuration tasks
  ansible.builtin.include_tasks: tls_config.yml
  tags:
    - splunk
    - tls
    - ssl
    - security

- name: Include authentication configuration tasks
  ansible.builtin.include_tasks: authentication_config.yml
  tags:
    - splunk
    - authentication
    - ldap
    - saml

- name: Include clustering configuration tasks
  ansible.builtin.include_tasks: clustering_config.yml
  when: splunk_cluster_mode != 'none'
  tags:
    - splunk
    - clustering
    - ha

- name: Include indexer configuration tasks
  ansible.builtin.include_tasks: indexer_config.yml
  when: splunk_cluster_mode in ['master', 'peer'] or splunk_cluster_mode == 'none'
  tags:
    - splunk
    - indexer
    - storage

- name: Include search head configuration tasks
  ansible.builtin.include_tasks: search_head_config.yml
  when: splunk_shc_mode | bool or splunk_cluster_mode == 'searchhead'
  tags:
    - splunk
    - search_head
    - shc

- name: Include deployment client configuration tasks
  ansible.builtin.include_tasks: deployment_client.yml
  when: splunk_deployment_server != ''
  tags:
    - splunk
    - deployment
    - client

- name: Include license configuration tasks
  ansible.builtin.include_tasks: license_config.yml
  when: splunk_license_file != '' or splunk_license_master != ''
  tags:
    - splunk
    - license

- name: Include file permissions hardening tasks
  ansible.builtin.include_tasks: file_permissions.yml
  tags:
    - splunk
    - permissions
    - security
    - stig

- name: Include SELinux configuration tasks
  ansible.builtin.include_tasks: selinux_config.yml
  when:
    - splunk_selinux_enabled | bool
    - ansible_selinux.status is defined
    - ansible_selinux.status == 'enabled'
  tags:
    - splunk
    - selinux
    - security

- name: Include firewall configuration tasks
  ansible.builtin.include_tasks: firewall_config.yml
  when: splunk_configure_firewall | bool
  tags:
    - splunk
    - firewall
    - network
    - security

- name: Include service configuration tasks
  ansible.builtin.include_tasks: service_config.yml
  tags:
    - splunk
    - service
    - systemd

- name: Include post-installation validation tasks
  ansible.builtin.include_tasks: postinstall_checks.yml
  tags:
    - splunk
    - postinstall
    - validation
