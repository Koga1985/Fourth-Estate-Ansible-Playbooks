---
# License configuration tasks

- name: Copy Splunk license file
  ansible.builtin.copy:
    src: "{{ splunk_license_file }}"
    dest: "{{ splunk_home }}/etc/licenses/enterprise/splunk.license"
    owner: "{{ splunk_user }}"
    group: "{{ splunk_group }}"
    mode: '0600'
  when: splunk_license_file != ''
  notify: restart splunk
  tags:
    - license

- name: Configure license master
  ansible.builtin.blockinfile:
    path: "{{ splunk_home }}/etc/system/local/server.conf"
    block: |
      [license]
      master_uri = {{ splunk_license_master }}
    create: yes
    owner: "{{ splunk_user }}"
    group: "{{ splunk_group }}"
    mode: '0600'
  when: splunk_license_master != ''
  notify: restart splunk
  tags:
    - license
