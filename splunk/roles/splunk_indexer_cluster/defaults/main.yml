---
# splunk_indexer_cluster/defaults/main.yml
# Production-ready Splunk Indexer Cluster defaults for Fourth Estate agencies

# Cluster Configuration
splunk_cluster_mode: "peer"  # Options: master, peer
splunk_cluster_master_uri: "https://{{ vault_cluster_master_host }}:8089"
splunk_cluster_label: "fourth_estate_prod_cluster"
splunk_cluster_secret: "{{ vault_splunk_cluster_secret }}"

# Replication Settings
splunk_cluster_replication_factor: 3
splunk_cluster_search_factor: 2
splunk_replication_port: 9887

# Multisite Clustering
splunk_multisite_clustering: false
splunk_cluster_site: "site1"
splunk_cluster_site_replication_factor: "origin:2, total:3"
splunk_cluster_site_search_factor: "origin:1, total:2"
splunk_cluster_available_sites: "site1, site2, site3"

# Index Configuration
splunk_indexes:
  # Security Indexes
  - name: security
    homePath: "$SPLUNK_DB/security/db"
    coldPath: "$SPLUNK_DB/security/colddb"
    thawedPath: "$SPLUNK_DB/security/thaweddb"
    maxDataSize: "auto_high_volume"
    maxHotBuckets: 10
    frozenTimePeriodInSecs: 31536000  # 1 year
    repFactor: "auto"
    datatype: "event"

  - name: firewall
    homePath: "$SPLUNK_DB/firewall/db"
    coldPath: "$SPLUNK_DB/firewall/colddb"
    thawedPath: "$SPLUNK_DB/firewall/thaweddb"
    maxDataSize: "auto_high_volume"
    maxHotBuckets: 10
    frozenTimePeriodInSecs: 31536000
    repFactor: "auto"

  - name: ids_ips
    homePath: "$SPLUNK_DB/ids_ips/db"
    coldPath: "$SPLUNK_DB/ids_ips/colddb"
    thawedPath: "$SPLUNK_DB/ids_ips/thaweddb"
    maxDataSize: "auto_high_volume"
    maxHotBuckets: 10
    frozenTimePeriodInSecs: 31536000
    repFactor: "auto"

  - name: endpoint
    homePath: "$SPLUNK_DB/endpoint/db"
    coldPath: "$SPLUNK_DB/endpoint/colddb"
    thawedPath: "$SPLUNK_DB/endpoint/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 6
    frozenTimePeriodInSecs: 15552000  # 180 days
    repFactor: "auto"

  - name: authentication
    homePath: "$SPLUNK_DB/authentication/db"
    coldPath: "$SPLUNK_DB/authentication/colddb"
    thawedPath: "$SPLUNK_DB/authentication/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 8
    frozenTimePeriodInSecs: 31536000
    repFactor: "auto"

  # Infrastructure Indexes
  - name: network
    homePath: "$SPLUNK_DB/network/db"
    coldPath: "$SPLUNK_DB/network/colddb"
    thawedPath: "$SPLUNK_DB/network/thaweddb"
    maxDataSize: "auto_high_volume"
    maxHotBuckets: 10
    frozenTimePeriodInSecs: 15552000  # 180 days
    repFactor: "auto"

  - name: web_logs
    homePath: "$SPLUNK_DB/web_logs/db"
    coldPath: "$SPLUNK_DB/web_logs/colddb"
    thawedPath: "$SPLUNK_DB/web_logs/thaweddb"
    maxDataSize: "auto_high_volume"
    maxHotBuckets: 10
    frozenTimePeriodInSecs: 15552000
    repFactor: "auto"

  - name: application
    homePath: "$SPLUNK_DB/application/db"
    coldPath: "$SPLUNK_DB/application/colddb"
    thawedPath: "$SPLUNK_DB/application/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 6
    frozenTimePeriodInSecs: 7776000  # 90 days
    repFactor: "auto"

  - name: database
    homePath: "$SPLUNK_DB/database/db"
    coldPath: "$SPLUNK_DB/database/colddb"
    thawedPath: "$SPLUNK_DB/database/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 6
    frozenTimePeriodInSecs: 31536000
    repFactor: "auto"

  # Fourth Estate Specific
  - name: editorial
    homePath: "$SPLUNK_DB/editorial/db"
    coldPath: "$SPLUNK_DB/editorial/colddb"
    thawedPath: "$SPLUNK_DB/editorial/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 4
    frozenTimePeriodInSecs: 31536000
    repFactor: "auto"

  - name: source_protection
    homePath: "$SPLUNK_DB/source_protection/db"
    coldPath: "$SPLUNK_DB/source_protection/colddb"
    thawedPath: "$SPLUNK_DB/source_protection/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 4
    frozenTimePeriodInSecs: 63072000  # 2 years
    repFactor: "auto"

  - name: compliance
    homePath: "$SPLUNK_DB/compliance/db"
    coldPath: "$SPLUNK_DB/compliance/colddb"
    thawedPath: "$SPLUNK_DB/compliance/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 4
    frozenTimePeriodInSecs: 63072000  # 2 years
    repFactor: "auto"

  # Cloud Indexes
  - name: aws
    homePath: "$SPLUNK_DB/aws/db"
    coldPath: "$SPLUNK_DB/aws/colddb"
    thawedPath: "$SPLUNK_DB/aws/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 6
    frozenTimePeriodInSecs: 15552000
    repFactor: "auto"

  - name: azure
    homePath: "$SPLUNK_DB/azure/db"
    coldPath: "$SPLUNK_DB/azure/colddb"
    thawedPath: "$SPLUNK_DB/azure/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 6
    frozenTimePeriodInSecs: 15552000
    repFactor: "auto"

  - name: gcp
    homePath: "$SPLUNK_DB/gcp/db"
    coldPath: "$SPLUNK_DB/gcp/colddb"
    thawedPath: "$SPLUNK_DB/gcp/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 4
    frozenTimePeriodInSecs: 15552000
    repFactor: "auto"

  # Summary/Metrics Indexes
  - name: summary
    homePath: "$SPLUNK_DB/summary/db"
    coldPath: "$SPLUNK_DB/summary/colddb"
    thawedPath: "$SPLUNK_DB/summary/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 4
    frozenTimePeriodInSecs: 31536000
    repFactor: "auto"

  - name: metrics
    homePath: "$SPLUNK_DB/metrics/db"
    coldPath: "$SPLUNK_DB/metrics/colddb"
    thawedPath: "$SPLUNK_DB/metrics/thaweddb"
    maxDataSize: "auto"
    maxHotBuckets: 4
    frozenTimePeriodInSecs: 7776000  # 90 days
    datatype: "metric"
    repFactor: "auto"

# Storage Volumes
splunk_storage_volumes:
  - name: hot_warm
    path: "/data/splunk/hot_warm"
    maxVolumeDataSizeMB: 500000

  - name: cold
    path: "/data/splunk/cold"
    maxVolumeDataSizeMB: 2000000

# SmartStore Configuration
splunk_smartstore_enabled: false
splunk_smartstore_provider: "aws"  # Options: aws, azure, gcp
splunk_smartstore_remote_name: "s3_remote"

# AWS S3 SmartStore
splunk_smartstore_s3_bucket: "{{ vault_splunk_smartstore_bucket }}"
splunk_smartstore_s3_region: "us-east-1"
splunk_smartstore_s3_access_key: "{{ vault_aws_access_key }}"
splunk_smartstore_s3_secret_key: "{{ vault_aws_secret_key }}"
splunk_smartstore_s3_endpoint: "https://s3.amazonaws.com"
splunk_smartstore_s3_server_side_encryption: "sse-s3"

# Cache Settings
splunk_smartstore_cache_size_gb: 100
splunk_smartstore_max_cache_size: "{{ splunk_smartstore_cache_size_gb }}GB"
splunk_smartstore_hotlist_recency_secs: 86400  # 1 day

# Bucket Rolling Policies
splunk_max_hot_buckets: 10
splunk_max_warm_db_count: 300
splunk_max_data_size: "auto_high_volume"
splunk_max_hot_idle_secs: 86400
splunk_max_hot_span_secs: 7776000  # 90 days

# Data Retention Policies (Fourth Estate compliance)
splunk_security_retention_days: 365
splunk_audit_retention_days: 730  # 2 years
splunk_application_retention_days: 90
splunk_infrastructure_retention_days: 180

# Compression Settings
splunk_compress_rawdata: true
splunk_rawdata_compression_level: 6

# Bucket Repair
splunk_enable_auto_repair: true
splunk_rebuild_metadata: true

# Cluster Master Apps
splunk_cluster_master_apps: []

# Cluster Peer Networks (for replication)
splunk_cluster_peer_networks:
  - "10.0.0.0/8"
  - "172.16.0.0/12"
  - "192.168.0.0/16"

# Monitoring and Health
splunk_enable_cluster_monitoring: true
splunk_cluster_health_check_interval: 300  # seconds

# Performance Tuning
splunk_max_concurrent_uploads: 10
splunk_max_concurrent_downloads: 10
splunk_upload_timeout: 3600
splunk_download_timeout: 3600

# Index Parallelization
splunk_parallel_ingestion_pipelines: 2

# Splunk Variables
splunk_home: "/opt/splunk"
splunk_db_path: "/opt/splunk/var/lib/splunk"
splunk_user: "splunk"
splunk_group: "splunk"
splunk_admin_user: "admin"
splunk_admin_password: "{{ vault_splunk_admin_password }}"
splunk_management_port: 8089
