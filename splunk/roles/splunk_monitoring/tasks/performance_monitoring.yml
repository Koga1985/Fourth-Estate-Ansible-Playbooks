---
# Performance monitoring configuration

- name: Create performance monitoring saved search
  ansible.builtin.copy:
    dest: "{{ splunk_home }}/etc/apps/search/local/savedsearches.conf"
    content: |
      [Splunk Performance Monitoring]
      search = index=_introspection | stats avg(data.cpu_system_pct) as avg_cpu, avg(data.mem_used) as avg_mem
      cron_schedule = */15 * * * *
      enableSched = 1
      dispatch.earliest_time = -15m
      dispatch.latest_time = now
    owner: "{{ splunk_user }}"
    mode: '0644'
