---
# STIG Category II (Medium Severity) Findings Remediation

- name: V-258120 - Configure password complexity
  ansible.builtin.blockinfile:
    path: "{{ splunk_home }}/etc/system/local/authentication.conf"
    block: |
      [authentication]
      minPasswordLength = {{ ia_password_min_length }}
      minPasswordDigit = 1
      minPasswordLowercase = 1
      minPasswordUppercase = 1
      minPasswordSpecial = 1
    marker: "# {mark} CAT2 V-258120 ANSIBLE MANAGED BLOCK"
  notify: restart splunk
  tags:
    - CAT2
    - V-258120

- name: V-258122 - Configure account lockout
  ansible.builtin.blockinfile:
    path: "{{ splunk_home }}/etc/system/local/authentication.conf"
    block: |
      lockoutAttempts = {{ ac_max_failed_login_attempts }}
      lockoutThresholdMins = {{ ac_account_lockout_duration_minutes }}
      lockoutMins = {{ ac_account_lockout_duration_minutes }}
    marker: "# {mark} CAT2 V-258122 ANSIBLE MANAGED BLOCK"
  notify: restart splunk
  tags:
    - CAT2
    - V-258122

- name: V-258124 - Enable password history
  ansible.builtin.lineinfile:
    path: "{{ splunk_home }}/etc/system/local/authentication.conf"
    line: "passwordHistoryCount = {{ ia_password_history_count }}"
  notify: restart splunk
  tags:
    - CAT2
    - V-258124

- name: V-258126 - Disable unnecessary services
  ansible.builtin.lineinfile:
    path: "{{ splunk_home }}/etc/system/local/web.conf"
    line: "enableWebDebug = false"
  notify: restart splunk
  tags:
    - CAT2
    - V-258126

- name: V-258128 - Enable secure cookie flag
  ansible.builtin.lineinfile:
    path: "{{ splunk_home }}/etc/system/local/web.conf"
    line: "cookieSecure = true"
  notify: restart splunk
  tags:
    - CAT2
    - V-258128
