---
# Access Control Hardening (NIST 800-53 AC family)

- name: Configure role-based access control
  ansible.builtin.copy:
    dest: "{{ splunk_home }}/etc/system/local/authorize.conf"
    content: |
      [role_admin]
      grantableRoles = admin;power;user
      importRoles = admin
      srchIndexesAllowed = *

      [role_power]
      importRoles = power
      srchIndexesAllowed = *

      [role_user]
      importRoles = user
      srchIndexesAllowed = main

      [role_auditor]
      importRoles = user
      srchIndexesAllowed = _audit;_internal
      srchMaxTime = 0
    owner: "{{ splunk_user }}"
    group: "{{ splunk_group }}"
    mode: '0600'
  notify: restart splunk
  tags:
    - access_control
    - rbac
