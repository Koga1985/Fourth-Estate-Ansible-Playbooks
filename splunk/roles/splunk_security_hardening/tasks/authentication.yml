---
# Authentication Hardening (NIST 800-53 IA family)

- name: Enforce multi-factor authentication
  ansible.builtin.debug:
    msg: "MFA should be configured through LDAP/SAML or third-party app"
  when: ia_enforce_mfa | bool
  tags:
    - authentication
    - mfa

- name: Configure password policy
  ansible.builtin.blockinfile:
    path: "{{ splunk_home }}/etc/system/local/authentication.conf"
    block: |
      [authentication]
      minPasswordLength = {{ ia_password_min_length }}
      minPasswordDigit = 1
      minPasswordLowercase = 1
      minPasswordUppercase = 1
      minPasswordSpecial = 1
      passwordHistoryCount = {{ ia_password_history_count }}
      enablePasswordHistory = true
    marker: "# {mark} ANSIBLE MANAGED AUTHENTICATION BLOCK"
  notify: restart splunk
  tags:
    - authentication
    - password
