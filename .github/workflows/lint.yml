---
name: Lint

on:
  pull_request:
    branches: [main, master]
  push:
    branches: [main, master]
  workflow_dispatch:

jobs:
  yaml-lint:
    name: YAML Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install yamllint
        run: pip install yamllint

      - name: Run yamllint
        run: |
          find . -name "*.yml" -o -name "*.yaml" | \
          grep -v ".github/workflows" | \
          xargs yamllint -c .yamllint.yml || true

  ansible-lint:
    name: Ansible Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Ansible and ansible-lint
        run: |
          pip install ansible ansible-lint

      - name: Run ansible-lint on playbooks
        run: |
          find . -name "*playbook*.yml" -type f | \
          xargs ansible-lint --offline || true

      - name: Run ansible-lint on roles
        run: |
          find . -path "*/roles/*/tasks/main.yml" | \
          xargs dirname | xargs dirname | \
          xargs -I {} ansible-lint {} || true

  markdown-lint:
    name: Markdown Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install markdownlint-cli
        run: npm install -g markdownlint-cli

      - name: Run markdownlint
        run: |
          find . -name "*.md" | \
          xargs markdownlint --config .markdownlint.json || true

  shellcheck:
    name: Shell Script Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run shellcheck
        run: |
          find . -name "*.sh" -type f | \
          xargs shellcheck || true

  lint-summary:
    name: Lint Summary
    runs-on: ubuntu-latest
    needs: [yaml-lint, ansible-lint, markdown-lint, shellcheck]
    if: always()
    steps:
      - name: Summary
        run: |
          echo "âœ… Linting workflow completed"
          echo "Check individual job results above"
