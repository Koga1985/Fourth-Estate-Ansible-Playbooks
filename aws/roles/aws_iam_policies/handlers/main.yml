---
# handlers file for aws_iam_policies

- name: notify iam policy changes
  ansible.builtin.debug:
    msg: "IAM policy configuration has been updated. Review policy versions and attachments."

- name: trigger compliance scan
  ansible.builtin.uri:
    url: "{{ compliance_webhook_url }}"
    method: POST
    body_format: json
    body:
      event: "iam_policy_change"
      timestamp: "{{ ansible_date_time.iso8601 }}"
      resource_type: "IAM Policy"
    status_code: [200, 201, 204]
  when: compliance_webhook_url is defined
  delegate_to: localhost
