---
# Cisco UCS Phase 4: Monitoring Setup
# Configure SNMP, Call Home, and health monitoring
# Run after Phase 3 security hardening

- name: Phase 4 - UCS Monitoring Setup
  hosts: localhost
  gather_facts: yes
  connection: local

  vars:
    apply_changes: false
    ucs_artifacts_dir: "/tmp/ucs-fourth-estate-artifacts/phase4"
    fourth_estate_org_name: "FourthEstate"

  pre_tasks:
    - name: Display Phase 4 banner
      ansible.builtin.debug:
        msg: |
          ════════════════════════════════════════════════════════════════
          PHASE 4: Monitoring Setup
          ════════════════════════════════════════════════════════════════
          Configuring:
            ✓ SNMP v2c/v3
            ✓ SNMP trap destinations
            ✓ Call Home for proactive monitoring
            ✓ System health checks
            ✓ Power/thermal monitoring
            ✓ Compliance monitoring
          ════════════════════════════════════════════════════════════════

    - name: Create Phase 4 artifacts directory
      ansible.builtin.file:
        path: "{{ ucs_artifacts_dir }}"
        state: directory
        mode: '0750'

  tasks:
    - name: Configure UCS monitoring
      ansible.builtin.include_role:
        name: ucs_prod_monitoring

  post_tasks:
    - name: Generate Phase 4 completion report
      ansible.builtin.copy:
        dest: "{{ ucs_artifacts_dir }}/phase4_complete.txt"
        mode: '0640'
        content: |
          Phase 4: Monitoring Setup - COMPLETE
          ═══════════════════════════════════════
          Completed: {{ ansible_date_time.iso8601 }}
          Status: {{ apply_changes | ternary('APPLIED', 'DRY RUN') }}

          Monitoring Components:
            ✓ SNMP configured
            ✓ SNMP traps configured
            ✓ Call Home enabled
            ✓ Health monitoring active
            ✓ Power/thermal monitoring
            ✓ Compliance checklists generated

          Integration Points:
            - SNMP trap receivers
            - SIEM integration ready
            - Health dashboard feeds

          Next Phase: Run 06_ucs_phase5_backup_dr.yml

    - name: Display next steps
      ansible.builtin.debug:
        msg: |
          Phase 4 Complete!
          Monitoring configured successfully.
          Next: ansible-playbook 06_ucs_phase5_backup_dr.yml
