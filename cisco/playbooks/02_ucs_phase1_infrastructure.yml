---
# Cisco UCS Phase 1: Infrastructure Deployment
# Deploy base infrastructure components only
# Use for initial deployment or infrastructure-only updates

- name: Phase 1 - UCS Infrastructure Deployment
  hosts: localhost
  gather_facts: yes
  connection: local

  vars:
    apply_changes: false
    ucs_artifacts_dir: "/tmp/ucs-fourth-estate-artifacts/phase1"
    fourth_estate_org_name: "FourthEstate"

  pre_tasks:
    - name: Display Phase 1 banner
      ansible.builtin.debug:
        msg: |
          ════════════════════════════════════════════════════════════════
          PHASE 1: Infrastructure Deployment
          ════════════════════════════════════════════════════════════════
          Deploying:
            ✓ UCS Manager configuration
            ✓ Organizations and hierarchy
            ✓ Service profiles
            ✓ Server pools and policies
            ✓ Network/Storage templates
            ✓ Address pools
            ✓ High availability
          ════════════════════════════════════════════════════════════════

    - name: Create Phase 1 artifacts directory
      ansible.builtin.file:
        path: "{{ ucs_artifacts_dir }}"
        state: directory
        mode: '0750'

  tasks:
    - name: Deploy UCS infrastructure
      ansible.builtin.include_role:
        name: ucs_prod_infrastructure

  post_tasks:
    - name: Generate Phase 1 completion report
      ansible.builtin.copy:
        dest: "{{ ucs_artifacts_dir }}/phase1_complete.txt"
        mode: '0640'
        content: |
          Phase 1: Infrastructure Deployment - COMPLETE
          ══════════════════════════════════════════════
          Completed: {{ ansible_date_time.iso8601 }}
          Status: {{ apply_changes | ternary('APPLIED', 'DRY RUN') }}

          Components Deployed:
            ✓ UCS Manager base configuration
            ✓ Fourth Estate organization structure
            ✓ Service profile templates
            ✓ Server pools
            ✓ UUID/MAC/WWN pools
            ✓ vNIC/vHBA templates
            ✓ High availability settings

          Next Phase: Run 03_ucs_phase2_networking.yml

    - name: Display next steps
      ansible.builtin.debug:
        msg: |
          Phase 1 Complete!
          Next: ansible-playbook 03_ucs_phase2_networking.yml
