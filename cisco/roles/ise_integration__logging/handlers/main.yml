---
# handlers file for ise_integration__logging

- name: backup ise configuration
  cisco.ise.backup_last_status_info:
    ise_hostname: "{{ ise_hostname }}"
    ise_username: "{{ ise_username }}"
    ise_password: "{{ ise_password }}"
    ise_verify: "{{ ise_verify_ssl }}"
  when: ise_auto_backup | default(false) | bool

- name: send notification
  ansible.builtin.mail:
    host: "{{ smtp_host | default('localhost') }}"
    port: "{{ smtp_port | default(25) }}"
    to: "{{ ise_integration__logging_notification_email }}"
    subject: "ISE ise_integration__logging Configuration Update"
    body: "ise_integration__logging has been updated on {{ ise_hostname }} at {{ ansible_date_time.iso8601 }}"
  when: ise_integration__logging_notify_on_completion | bool
  ignore_errors: true

- name: log changes to syslog
  ansible.builtin.syslog:
    msg: "ISE ise_integration__logging configuration updated"
    priority: "info"
    facility: "local0"
  when: ise_integration__logging_log_to_syslog | bool
