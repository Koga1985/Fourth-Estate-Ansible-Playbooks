---
# handlers file for ucs_security_hardening

- name: backup ucs configuration
  cisco.ucs.ucs_backup:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    type: config-all
    backup_path: "{{ ucs_artifacts_dir }}/backup_{{ ansible_date_time.epoch }}.xml"
  when: ucs_security_hardening_auto_backup | bool

- name: validate ucs configuration
  cisco.ucs.ucs_query:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    class_ids: faultInst
  register: ucs_faults

- name: send notification
  ansible.builtin.debug:
    msg: "UCS ucs_security_hardening configuration updated on {{ ucs_hostname }}"
