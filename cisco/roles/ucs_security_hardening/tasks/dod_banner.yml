---
# DoD Banner Configuration

- name: Configure DoD login banner
  cisco.ucs.ucs_managed_objects:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    objects:
      - module: ucsmsdk.mometa.aaauser.AaaaUserEp
        class: AaaaUserEp
        properties:
          parent_mo_or_dn: sys
          banner: "{{ dod_banner_text }}"
  when: apply_changes | bool

- name: Configure message of the day
  ansible.builtin.debug:
    msg: "DoD banner configured for all login sessions"

- name: Save banner configuration
  ansible.builtin.copy:
    dest: "{{ ucs_artifacts_dir }}/dod_banner.txt"
    mode: '0640'
    content: |
      DoD Banner Configuration
      ========================
      {{ dod_banner_text }}

      This banner is displayed to all users upon login and meets
      DoD requirements for system use notifications.

      Configured: {{ ansible_date_time.iso8601 }}
  delegate_to: localhost
