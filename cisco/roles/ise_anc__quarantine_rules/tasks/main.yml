---
- name: Ensure artifacts dir
  ansible.builtin.file:
    path: "{{ artifacts_dir }}"
    state: directory

- name: Emit ANC plan
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/anc_plan.json"
    mode: "0644"
    content: "{{ {'policies': anc_policies, 'exceptions': exceptions} | to_nice_json }}"

- name: Ensure ANC policies (guarded placeholder)
  when: apply_changes | bool
  loop: "{{ anc_policies }}"
  loop_control:
    label: "{{ item.name }}"
  ansible.builtin.debug:
    msg: "Ensure ANC policy {{ item.name }} with actions {{ item.actions }}"

- name: Register ANC exceptions (guarded placeholder)
  when: apply_changes | bool and (exceptions|length) > 0
  ansible.builtin.debug:
    msg: "Register ANC exceptions (MAC/expiry)"
