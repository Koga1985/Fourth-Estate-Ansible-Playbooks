---
# UCS Manager initial configuration tasks

- name: Configure UCS Manager system name
  cisco.ucs.ucs_system:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ ucs_system_name }}"
    descr: "{{ ucs_system_description }}"
  when: apply_changes | bool

- name: Configure DNS servers
  cisco.ucs.ucs_dns_server:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    dns_server: "{{ item }}"
    state: present
  loop: "{{ ucs_dns_servers }}"
  when: apply_changes | bool

- name: Configure NTP servers for time synchronization
  cisco.ucs.ucs_ntp_server:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    ntp_server: "{{ item }}"
    state: present
  loop: "{{ ucs_ntp_servers }}"
  when: apply_changes | bool

- name: Configure timezone
  cisco.ucs.ucs_timezone:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    timezone: "{{ ucs_timezone }}"
  when: apply_changes | bool

- name: Configure call home for fourth estate monitoring
  cisco.ucs.ucs_callhome:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    admin_state: "{{ ucs_callhome_enabled | ternary('on', 'off') }}"
    contact: "{{ fourth_estate_contact }}"
    phone: "{{ fourth_estate_phone }}"
    email: "{{ fourth_estate_email }}"
    addr: "{{ fourth_estate_address }}"
  when: apply_changes | bool

- name: Configure SNMP community strings (if enabled)
  cisco.ucs.ucs_snmp_community:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    community_string: "{{ item.community }}"
    descr: "{{ item.description }}"
  loop: "{{ ucs_snmp_communities }}"
  when:
    - apply_changes | bool
    - ucs_enable_snmp | bool
  no_log: true
