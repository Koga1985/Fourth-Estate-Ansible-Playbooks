---
# Service profile template configuration

- name: Create service profile templates for fourth estate
  cisco.ucs.ucs_service_profile_template:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    template_type: "{{ item.template_type | default('updating-template') }}"
    uuid_pool: "{{ item.uuid_pool | default('') }}"
    description: "{{ item.description }}"
    bios_policy: "{{ item.bios_policy | default('') }}"
    boot_policy: "{{ item.boot_policy | default('') }}"
    maint_policy: "{{ item.maint_policy | default('') }}"
    power_policy: "{{ item.power_policy | default('') }}"
    local_disk_policy: "{{ item.local_disk_policy | default('') }}"
    host_firmware_package: "{{ item.host_firmware_package | default('') }}"
    state: present
  loop: "{{ ucs_service_profile_templates }}"
  when: apply_changes | bool

- name: Create BIOS policies for fourth estate servers
  cisco.ucs.ucs_bios_policy:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    descr: "{{ item.description }}"
    reboot_on_update: "{{ item.reboot_on_update | default('yes') }}"
  loop: "{{ ucs_bios_policies }}"
  when: apply_changes | bool

- name: Create boot policies for servers
  cisco.ucs.ucs_boot_policy:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    descr: "{{ item.description }}"
    boot_mode: "{{ item.boot_mode | default('uefi') }}"
    enforce_vnic_name: "{{ item.enforce_vnic_name | default('yes') }}"
    reboot_on_update: "{{ item.reboot_on_update | default('no') }}"
    state: present
  loop: "{{ ucs_boot_policies }}"
  when: apply_changes | bool

- name: Create maintenance policies
  cisco.ucs.ucs_maintenance_policy:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    descr: "{{ item.description }}"
    uptime_disr: "{{ item.uptime_disr | default('user-ack') }}"
    state: present
  loop: "{{ ucs_maintenance_policies }}"
  when: apply_changes | bool
