---
# Server pool configuration

- name: Create server pools for fourth estate workloads
  cisco.ucs.ucs_server_pool:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    description: "{{ item.description }}"
    state: present
  loop: "{{ ucs_server_pools }}"
  when: apply_changes | bool

- name: Add servers to pools based on qualifications
  cisco.ucs.ucs_server_pool_qualification:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    server_pool: "{{ item.pool }}"
    qualification: "{{ item.qualification }}"
    state: present
  loop: "{{ ucs_server_pool_qualifications }}"
  when: apply_changes | bool

- name: Create power groups for fourth estate
  cisco.ucs.ucs_power_group:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    descr: "{{ item.description }}"
    state: present
  loop: "{{ ucs_power_groups }}"
  when: apply_changes | bool
