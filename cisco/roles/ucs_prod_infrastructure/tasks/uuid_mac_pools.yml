---
# UUID and address pool configuration

- name: Create UUID suffix pools for fourth estate
  cisco.ucs.ucs_uuid_pool:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    prefix: "{{ item.prefix }}"
    first_uuid: "{{ item.first_uuid }}"
    last_uuid: "{{ item.last_uuid }}"
    order: "{{ item.order | default('sequential') }}"
    descr: "{{ item.description }}"
    state: present
  loop: "{{ ucs_uuid_pools }}"
  when: apply_changes | bool

- name: Create MAC address pools for vNICs
  cisco.ucs.ucs_mac_pool:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    first_addr: "{{ item.first_addr }}"
    last_addr: "{{ item.last_addr }}"
    order: "{{ item.order | default('sequential') }}"
    descr: "{{ item.description }}"
    state: present
  loop: "{{ ucs_mac_pools }}"
  when: apply_changes | bool

- name: Create WWNN pools for SAN
  cisco.ucs.ucs_wwn_pool:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    purpose: node
    first_addr: "{{ item.first_addr }}"
    last_addr: "{{ item.last_addr }}"
    order: "{{ item.order | default('sequential') }}"
    descr: "{{ item.description }}"
    state: present
  loop: "{{ ucs_wwnn_pools }}"
  when:
    - apply_changes | bool
    - ucs_enable_san | bool

- name: Create WWPN pools for SAN (Fabric A)
  cisco.ucs.ucs_wwn_pool:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    purpose: port
    first_addr: "{{ item.first_addr }}"
    last_addr: "{{ item.last_addr }}"
    order: "{{ item.order | default('sequential') }}"
    descr: "{{ item.description }}"
    state: present
  loop: "{{ ucs_wwpn_pools_a }}"
  when:
    - apply_changes | bool
    - ucs_enable_san | bool

- name: Create WWPN pools for SAN (Fabric B)
  cisco.ucs.ucs_wwn_pool:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    purpose: port
    first_addr: "{{ item.first_addr }}"
    last_addr: "{{ item.last_addr }}"
    order: "{{ item.order | default('sequential') }}"
    descr: "{{ item.description }}"
    state: present
  loop: "{{ ucs_wwpn_pools_b }}"
  when:
    - apply_changes | bool
    - ucs_enable_san | bool

- name: Create IQN suffix pools for iSCSI
  cisco.ucs.ucs_iqn_pool:
    hostname: "{{ ucs_hostname }}"
    username: "{{ ucs_username }}"
    password: "{{ ucs_password }}"
    name: "{{ item.name }}"
    org_dn: "org-root/org-{{ fourth_estate_org_name }}"
    prefix: "{{ item.prefix }}"
    suffix_start: "{{ item.suffix_start }}"
    suffix_end: "{{ item.suffix_end }}"
    descr: "{{ item.description }}"
    state: present
  loop: "{{ ucs_iqn_pools }}"
  when:
    - apply_changes | bool
    - ucs_enable_iscsi | bool
