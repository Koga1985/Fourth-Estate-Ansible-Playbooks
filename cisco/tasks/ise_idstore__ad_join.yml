
---
- name: ise_idstore__ad_join â€” AD join
  hosts: localhost
  connection: local
  gather_facts: false
  collections:
    - cisco.ise
    - community.general
  vars:
    artifacts_dir: "{ artifacts_dir | default('/tmp/ise-artifacts') }"
    apply_changes: "{ apply_changes | default(false) }"

  vars:
    ad_domain: ""
    ad_username: ""
    ad_password: ""
    dns_servers: []
    advanced:
      site: ""
      dnsSRV: true
  tasks:
    - name: Emit plan
      ansible.builtin.copy:
        dest: "{{ artifacts_dir }}/ad_join_plan.json"
        mode: "0644"
        content: "{{ {'domain': ad_domain, 'dns': dns_servers, 'advanced': advanced} | to_nice_json }}"
    - name: Join AD (placeholder)
      when: apply_changes | bool
      ansible.builtin.debug:
        msg: "Join domain {{ ad_domain }} via ISE AD join endpoints."
