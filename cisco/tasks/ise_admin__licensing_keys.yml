
---
- name: ise_admin__licensing_keys â€” smart/traditional
  hosts: localhost
  connection: local
  gather_facts: false
  collections:
    - cisco.ise
    - community.general
  vars:
    artifacts_dir: "{ artifacts_dir | default('/tmp/ise-artifacts') }"
    apply_changes: "{ apply_changes | default(false) }"

  vars:
    smart_licensing:
      enabled: false
      account: ""
      virtualAccount: ""
      token: ""
    traditional_keys: []
  tasks:
    - name: Emit plan
      ansible.builtin.copy:
        dest: "{{ artifacts_dir }}/licensing_plan.json"
        mode: "0644"
        content: "{{ {'smart': smart_licensing, 'traditional': traditional_keys} | to_nice_json }}"

    - name: Apply smart licensing (placeholder)
      when: apply_changes | bool and (smart_licensing.enabled | default(false))
      ansible.builtin.debug:
        msg: "Call ISE smart licensing endpoints with provided token."

    - name: Apply traditional license keys
      when: apply_changes | bool
      loop: "{{ traditional_keys }}"
      loop_control:
        label: "key-{{ loop.index }}"
      ansible.builtin.debug:
        msg: "Submitting license key {{ item }}"
