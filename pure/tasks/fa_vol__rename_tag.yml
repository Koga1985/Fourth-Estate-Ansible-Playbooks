---
# vars:
# vol_renames:
#   - { name: app01-dbtemp, new_name: app01-db01, tags: { env: prod, role: db } }
- name: Rename volumes (if needed)
  purestorage.flasharray.purefa_volume:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    name: "{{ item.name }}"
    new_name: "{{ item.new_name }}"
    state: present
  loop: "{{ vol_renames | default([]) }}"
  loop_control: { label: "{{ item.name }} -> {{ item.new_name }}" }

- name: Apply/Update tags (labels)
  purestorage.flasharray.purefa_volume:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    name: "{{ item.new_name | default(item.name) }}"
    labels: "{{ item.tags | default(omit) }}"
    state: present
  loop: "{{ vol_renames | default([]) }}"
  loop_control: { label: "{{ item.new_name | default(item.name) }}" }
