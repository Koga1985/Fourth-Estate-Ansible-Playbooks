---
# vars example:
# pg_links:
#   - pgroup: pg-app01
#     target: fa-dr01
#     rpo: "10m"
#     pause: false
#     throttle_mbps: 0       # 0 = unlimited
- name: Link protection groups for replication
  purestorage.flasharray.purefa_pg:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    pgroup: "{{ item.pgroup }}"
    target: "{{ item.target }}"
    replicate: true
    state: present
  loop: "{{ pg_links | default([]) }}"
  loop_control: { label: "{{ item.pgroup }} -> {{ item.target }}" }

- name: (Optional) Pause/Resume replication
  when: item.pause is defined
  purestorage.flasharray.purefa_pg:
    fa_url: "{{ fa_url }}"
    api_token: "{{ api_token }}"
    pgroup: "{{ item.pgroup }}"
    target: "{{ item.target }}"
    pause: "{{ item.pause | bool }}"
    state: present
  loop: "{{ pg_links | default([]) }}"
  loop_control: { label: "{{ item.pgroup }} pause={{ item.pause | default(false) }}" }
