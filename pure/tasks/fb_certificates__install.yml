---
# vars example:
# certs:
#   https:
#     cert: "/etc/pki/tls/certs/fb.crt"
#     key: "/etc/pki/tls/private/fb.key"
#     chain: "/etc/pki/tls/certs/fb-chain.crt"
#   s3:
#     cert: "/etc/pki/tls/certs/s3.crt"
#     key: "/etc/pki/tls/private/s3.key"
#     chain: "/etc/pki/tls/certs/s3-chain.crt"
- name: Install HTTPS certificate
  ansible.builtin.uri:
    url: "{{ fb_url }}/api/1.12/certificates/https"
    method: POST
    headers: { "api-token": "{{ fb_token }}" }
    body_format: form-multipart
    body:
      cert: "{{ lookup('ansible.builtin.file', certs.https.cert) }}"
      key: "{{ lookup('ansible.builtin.file', certs.https.key) }}"
      chain: "{{ (lookup('ansible.builtin.file', certs.https.chain)) if (certs.https.chain is defined) else omit }}"
    status_code: [200,201,204]
    validate_certs: "{{ fb_validate_certs | default(false) }}"
  when: certs.https is defined

- name: Install S3 certificate
  ansible.builtin.uri:
    url: "{{ fb_url }}/api/1.12/certificates/s3"
    method: POST
    headers: { "api-token": "{{ fb_token }}" }
    body_format: form-multipart
    body:
      cert: "{{ lookup('ansible.builtin.file', certs.s3.cert) }}"
      key: "{{ lookup('ansible.builtin.file', certs.s3.key) }}"
      chain: "{{ (lookup('ansible.builtin.file', certs.s3.chain)) if (certs.s3.chain is defined) else omit }}"
    status_code: [200,201,204]
    validate_certs: "{{ fb_validate_certs | default(false) }}"
  when: certs.s3 is defined
