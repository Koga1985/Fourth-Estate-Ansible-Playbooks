---
# Pure Storage Deployment Playbook
# Entry point for Pure FlashArray and FlashBlade automation
#
# Usage:
#   ansible-galaxy collection install -r requirements.yml
#   ansible-playbook -i inventory site.yml --ask-vault-pass

- name: Pure Storage Configuration
  hosts: localhost
  connection: local
  gather_facts: true

  vars:
    deploy_fa_provisioning: true
    deploy_fa_protection: true
    deploy_fa_integrations: true
    deploy_fa_governance: true
    deploy_fb_provisioning: true
    deploy_fb_protection: true
    deploy_fb_ops: true

  tasks:
    # FlashArray
    - name: Phase 1 - FA Provisioning
      ansible.builtin.include_role:
        name: pure_fa_provisioning
      when: deploy_fa_provisioning | bool
      tags: ['flasharray', 'provisioning', 'phase1']

    - name: Phase 2 - FA Data Protection
      ansible.builtin.include_role:
        name: pure_fa_data_protection
      when: deploy_fa_protection | bool
      tags: ['flasharray', 'protection', 'phase2']

    - name: Phase 3 - FA Integrations
      ansible.builtin.include_role:
        name: pure_fa_integrations
      when: deploy_fa_integrations | bool
      tags: ['flasharray', 'integrations', 'phase3']

    - name: Phase 4 - FA Ops Governance
      ansible.builtin.include_role:
        name: pure_fa_ops_governance
      when: deploy_fa_governance | bool
      tags: ['flasharray', 'governance', 'phase4']

    # FlashBlade
    - name: Phase 5 - FB Provisioning
      ansible.builtin.include_role:
        name: pure_fb_provisioning
      when: deploy_fb_provisioning | bool
      tags: ['flashblade', 'provisioning', 'phase5']

    - name: Phase 6 - FB Data Protection
      ansible.builtin.include_role:
        name: pure_fb_data_protection
      when: deploy_fb_protection | bool
      tags: ['flashblade', 'protection', 'phase6']

    - name: Phase 7 - FB Operations
      ansible.builtin.include_role:
        name: pure_fb_ops
      when: deploy_fb_ops | bool
      tags: ['flashblade', 'ops', 'phase7']

    - name: Display summary
      ansible.builtin.debug:
        msg:
          - "=== Pure Storage Deployment Complete ==="
      tags: ['always']
