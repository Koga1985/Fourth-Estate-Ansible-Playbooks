---
# Tenable Security Center Deployment Playbook
# Entry point for Tenable vulnerability management automation
#
# Usage:
#   ansible-galaxy collection install -r requirements.yml
#   ansible-playbook -i inventory site.yml --ask-vault-pass

- name: Tenable Configuration
  hosts: localhost
  connection: local
  gather_facts: true

  vars:
    deploy_install: false
    deploy_config: true
    deploy_scan_zones: true
    deploy_scan_policies: true
    deploy_schedules: true
    deploy_compliance: true
    deploy_reporting: true
    deploy_vuln_mgmt: true

  tasks:
    - name: Phase 1 - Security Center Installation
      ansible.builtin.include_role:
        name: tenable_security_center_install
      when: deploy_install | bool
      tags: ['install', 'phase1']

    - name: Phase 2 - Security Center Configuration
      ansible.builtin.include_role:
        name: tenable_security_center_config
      when: deploy_config | bool
      tags: ['config', 'phase2']

    - name: Phase 3 - Scan Zones
      ansible.builtin.include_role:
        name: tenable_scan_zones
      when: deploy_scan_zones | bool
      tags: ['zones', 'phase3']

    - name: Phase 4 - Scan Policies
      ansible.builtin.include_role:
        name: tenable_scan_policies
      when: deploy_scan_policies | bool
      tags: ['policies', 'phase4']

    - name: Phase 5 - Scan Schedules
      ansible.builtin.include_role:
        name: tenable_scan_schedules
      when: deploy_schedules | bool
      tags: ['schedules', 'phase5']

    - name: Phase 6 - Compliance Checks
      ansible.builtin.include_role:
        name: tenable_compliance_checks
      when: deploy_compliance | bool
      tags: ['compliance', 'phase6']

    - name: Phase 7 - Vulnerability Management
      ansible.builtin.include_role:
        name: tenable_vulnerability_management
      when: deploy_vuln_mgmt | bool
      tags: ['vulnerability', 'phase7']

    - name: Phase 8 - Reporting
      ansible.builtin.include_role:
        name: tenable_reporting
      when: deploy_reporting | bool
      tags: ['reporting', 'phase8']

    - name: Display summary
      ansible.builtin.debug:
        msg:
          - "=== Tenable Deployment Complete ==="
          - "Security Center: {{ tenable_sc_url }}"
      tags: ['always']
