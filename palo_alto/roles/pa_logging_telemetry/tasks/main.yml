---
- name: Ensure artifacts dir exists
  ansible.builtin.file:
    path: "{{ artifacts_dir }}"
    state: directory
    mode: "0755"

- name: Configure SYSLOG server profiles
  import_tasks: syslog_profiles.yml

- name: Configure HTTP server profiles
  import_tasks: http_profiles.yml

- name: Configure Log Forwarding Profiles
  import_tasks: log_forwarding_profiles.yml

- name: (Optional) Bind Log Forwarding Profile to tagged rules
  import_tasks: bind_to_rules.yml

- name: (Optional) Enable device telemetry
  import_tasks: telemetry.yml

- name: (Optional) Generate Tech-Support bundle
  import_tasks: techsupport.yml

- name: Commit changes (Panorama or firewall)
  when: commit_after_changes | bool
  paloaltonetworks.panos.panos_commit:
    description: "{{ commit_description }}"
