---
- name: Create/Update LDAP Server Profiles
  paloaltonetworks.panos.panos_ldap_server_profile:
    name: "{{ item.name }}"
    servers: "{{ item.servers }}"
    bind_dn: "{{ item.bind_dn | default(omit) }}"
    password: "{{ item.bind_password | default(omit) }}"
    ssl: "{{ item.ssl | default(false) }}"
    base_dn: "{{ item.base_dn | default(omit) }}"
    device_group: "{{ device_group if pa_use_panorama | bool else omit }}"
    vsys: "{{ vsys if not (pa_use_panorama | bool) else omit }}"
    state: "present"
  loop: "{{ ldap_server_profiles | default([]) }}"
  loop_control: { label: "{{ item.name }}" }
