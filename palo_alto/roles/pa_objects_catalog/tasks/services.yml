---
- name: Ensure service objects
  paloaltonetworks.panos.panos_service_object:
    name: "{{ item.name }}"
    destination_port: "{{ item.destination_port }}"
    protocol: "{{ item.protocol | default('tcp') }}"
    description: "{{ item.description | default(omit) }}"
    tags: "{{ item.tags | default(omit) }}"
    device_group: "{{ device_group if pa_use_panorama | bool else omit }}"
    vsys: "{{ vsys if not (pa_use_panorama | bool) else omit }}"
    state: present
  loop: "{{ service_objects | default([]) }}"
  loop_control: { label: "{{ item.name }}" }

- name: Ensure service groups
  paloaltonetworks.panos.panos_service_group:
    name: "{{ item.name }}"
    value: "{{ item.members | default([]) }}"
    description: "{{ item.description | default(omit) }}"
    tags: "{{ item.tags | default(omit) }}"
    device_group: "{{ device_group if pa_use_panorama | bool else omit }}"
    vsys: "{{ vsys if not (pa_use_panorama | bool) else omit }}"
    state: present
  loop: "{{ service_groups | default([]) }}"
  loop_control: { label: "{{ item.name }}" }
