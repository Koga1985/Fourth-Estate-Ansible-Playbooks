---
- name: Create tunnel interfaces
  paloaltonetworks.panos.panos_tunnel:
    name: "{{ item.name }}"
    comment: "{{ item.comment | default(omit) }}"
    template: "{{ template | default(omit) if pa_use_panorama | bool else omit }}"
    template_stack: "{{ template_stack | default(omit) if pa_use_panorama | bool else omit }}"
    state: present
  loop: "{{ tunnels | default([]) }}"
  loop_control: { label: "{{ item.name }}" }

- name: Assign IP to tunnel
  when: item.ip is defined
  paloaltonetworks.panos.panos_interface:
    if_name: "{{ item.name }}"
    mode: "layer3"
    ip: ["{{ item.ip }}"]
    template: "{{ template | default(omit) if pa_use_panorama | bool else omit }}"
    template_stack: "{{ template_stack | default(omit) if pa_use_panorama | bool else omit }}"
    state: present
  loop: "{{ tunnels | default([]) }}"
  loop_control: { label: "{{ item.name }}" }
