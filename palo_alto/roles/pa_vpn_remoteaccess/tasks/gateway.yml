---
- name: Configure GP Gateway (basic)
  when: gp_gateway.enabled | default(true) | bool
  paloaltonetworks.panos.panos_gpg:
    name: "{{ gp_gateway.name }}"
    interface: "{{ gp_gateway.interface }}"
    ip_address: "{{ gp_gateway.ip | default(omit) }}"
    tunnel_interface: "{{ gp_gateway.tunnel_interface }}"
    certificate_profile: "{{ gp_gateway.gateway_cert | default(omit) }}"
    authentication_profile: "{{ gp_gateway.auth_profile | default(omit) }}"
    ip_pool: "{{ gp_gateway.ip_pool | default(omit) }}"
    ssl_tls_service_profile: "{{ gp_gateway.ssl_tls_service_profile | default(omit) }}"
    template: "{{ template | default(omit) if pa_use_panorama | bool else omit }}"
    template_stack: "{{ template_stack | default(omit) if pa_use_panorama | bool else omit }}"
    state: "present"
- name: Configure GP Gateway agent configs
  when: gp_gateway.enabled | default(true) | bool
  paloaltonetworks.panos.panos_gpg:
    name: "{{ gp_gateway.name }}"
    agent_config:
      - name: "{{ item.name }}"
        access_route: "{{ item.access_route | default(omit) }}"
        split_tunnel: "{{ item.split_tunnel | default(omit) }}"
        dns_primary: "{{ item.dns_primary | default(omit) }}"
        dns_suffix: "{{ item.dns_suffix | default(omit) }}"
    template: "{{ template | default(omit) if pa_use_panorama | bool else omit }}"
    template_stack: "{{ template_stack | default(omit) if pa_use_panorama | bool else omit }}"
    state: "present"
  loop: "{{ gp_gateway.agent_configs | default([]) }}"
  loop_control: { label: "{{ item.name }}" }
