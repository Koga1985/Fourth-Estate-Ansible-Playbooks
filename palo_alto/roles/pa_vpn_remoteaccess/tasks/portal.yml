---
- name: Configure GP Portal (basic)
  when: gp_portal.enabled | default(true) | bool
  paloaltonetworks.panos.panos_gpp:
    name: "{{ gp_portal.name }}"
    interface: "{{ gp_portal.interface }}"
    ip_address: "{{ gp_portal.ip | default(omit) }}"
    certificate_profile: "{{ gp_portal.portal_cert | default(omit) }}"
    authentication_profile: "{{ gp_portal.authentication_profile | default(omit) }}"
    template: "{{ template | default(omit) if pa_use_panorama | bool else omit }}"
    template_stack: "{{ template_stack | default(omit) if pa_use_panorama | bool else omit }}"
    state: "present"
- name: Configure GP Portal client configs
  when: gp_portal.enabled | default(true) | bool
  paloaltonetworks.panos.panos_gpp:
    name: "{{ gp_portal.name }}"
    client_config:
      - name: "{{ item.name }}"
        source_user: "{{ item.user_groups | default(omit) }}"
        source_address: "{{ item.source_addresses | default(omit) }}"
        dns_primary: "{{ item.dns_primary | default(omit) }}"
        dns_suffix: "{{ item.dns_suffix | default(omit) }}"
        split_tunnel: "{{ item.split_tunnel | default(omit) }}"
    template: "{{ template | default(omit) if pa_use_panorama | bool else omit }}"
    template_stack: "{{ template_stack | default(omit) if pa_use_panorama | bool else omit }}"
    state: "present"
  loop: "{{ gp_portal.client_configs | default([]) }}"
  loop_control: { label: "{{ item.name }}" }
