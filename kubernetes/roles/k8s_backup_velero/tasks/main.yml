---
# Velero Kubernetes Backup - Main Tasks
# Fourth Estate production-ready backup solution

- name: Include pre-flight checks
  ansible.builtin.include_tasks: preflight.yml
  tags: [preflight, always]

- name: Include credentials setup
  ansible.builtin.include_tasks: credentials.yml
  tags: [credentials, secrets]

- name: Include MinIO setup (if enabled)
  ansible.builtin.include_tasks: minio.yml
  when: velero_minio_enabled | bool
  tags: [minio, storage]

- name: Include Velero installation
  ansible.builtin.include_tasks: install.yml
  tags: [install, velero]

- name: Include backup schedules configuration
  ansible.builtin.include_tasks: schedules.yml
  when: velero_backup_schedule_enabled | bool
  tags: [schedules, backup]

- name: Include monitoring configuration
  ansible.builtin.include_tasks: monitoring.yml
  when: velero_enable_prometheus_metrics | bool
  tags: [monitoring, metrics]

- name: Include security configuration
  ansible.builtin.include_tasks: security.yml
  tags: [security, hardening]

- name: Include backup verification
  ansible.builtin.include_tasks: verification.yml
  when: velero_enable_backup_verification | bool
  tags: [verification, validation]

- name: Include Fourth Estate specific configuration
  ansible.builtin.include_tasks: fourth_estate.yml
  when: velero_fourth_estate_enabled | bool
  tags: [fourth-estate, compliance]
