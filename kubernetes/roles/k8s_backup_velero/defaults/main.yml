---
# Velero Kubernetes Backup - Defaults
# Fourth Estate production-ready backup solution

# Velero Installation
velero_version: "v1.12.3"
velero_namespace: "velero"
velero_install_method: "helm"  # Options: helm, cli
velero_cli_version: "1.12.3"

# Backup Provider Configuration
velero_provider: "aws"  # Options: aws, azure, gcp, minio, restic
velero_use_restic: true
velero_use_volume_snapshots: true

# AWS S3 Configuration
velero_aws_region: "us-gov-west-1"
velero_aws_bucket: "fourth-estate-k8s-backups"
velero_aws_backup_location: "default"
velero_aws_credentials_secret: "cloud-credentials"
velero_aws_kms_key_id: ""
velero_aws_s3_url: ""  # Custom S3 endpoint (for S3-compatible storage)
velero_aws_s3_force_path_style: false

# Azure Configuration
velero_azure_storage_account: ""
velero_azure_storage_key: ""
velero_azure_resource_group: ""
velero_azure_subscription_id: ""
velero_azure_container: "velero"

# GCP Configuration
velero_gcp_project: ""
velero_gcp_bucket: ""
velero_gcp_service_account_key: ""

# MinIO Configuration (Air-gapped/On-prem)
velero_minio_enabled: false
velero_minio_endpoint: "minio.{{ velero_namespace }}.svc:9000"
velero_minio_access_key: ""
velero_minio_secret_key: ""
velero_minio_bucket: "velero"
velero_minio_use_ssl: true

# Backup Configuration
velero_default_backup_ttl: "720h"  # 30 days
velero_backup_schedule_enabled: true
velero_backup_schedules:
  - name: "daily-full"
    schedule: "0 2 * * *"  # 2 AM daily
    ttl: "720h"  # 30 days
    include_namespaces: []  # Empty means all namespaces
    exclude_namespaces:
      - kube-system
      - kube-public
      - kube-node-lease
    include_resources: []
    exclude_resources: []
    snapshot_volumes: true
    labels:
      backup-type: "daily"
      environment: "production"
  - name: "hourly-critical"
    schedule: "0 * * * *"  # Every hour
    ttl: "168h"  # 7 days
    include_namespaces:
      - production
      - database
      - critical-apps
    snapshot_volumes: true
    labels:
      backup-type: "hourly"
      criticality: "high"

# Snapshot Configuration
velero_snapshot_location_name: "default"
velero_volume_snapshot_locations: []

# Restic Configuration
velero_restic_prune_interval: "168h"  # 7 days
velero_restic_timeout: "4h"
velero_restic_resource_requests:
  cpu: "500m"
  memory: "512Mi"
velero_restic_resource_limits:
  cpu: "1000m"
  memory: "1Gi"

# Velero Server Configuration
velero_server_resource_requests:
  cpu: "500m"
  memory: "512Mi"
velero_server_resource_limits:
  cpu: "1000m"
  memory: "1Gi"

# Plugin Configuration
velero_plugins:
  - name: "velero-plugin-for-aws"
    image: "velero/velero-plugin-for-aws:v1.8.2"
  - name: "velero-plugin-for-csi"
    image: "velero/velero-plugin-for-csi:v0.6.2"

# Monitoring and Alerting
velero_enable_prometheus_metrics: true
velero_metrics_port: 8085
velero_enable_backup_alerts: true
velero_alert_on_failure: true

# Security Configuration
velero_service_account: "velero"
velero_enable_pod_security_policy: true
velero_pod_security_standard: "restricted"
velero_enable_network_policy: true

# Restore Configuration
velero_default_restore_priority:
  - namespaces
  - customresourcedefinitions
  - persistentvolumes
  - persistentvolumeclaims
  - secrets
  - configmaps
  - serviceaccounts
  - services
  - deployments
  - statefulsets
  - daemonsets
  - jobs
  - cronjobs

# Fourth Estate Specific
velero_fourth_estate_enabled: true
velero_source_protection_backup: true
velero_journalist_data_backup: true
velero_publication_backup: true
velero_air_gapped_mode: false
velero_encryption_enabled: true
velero_encryption_key_rotation: true

# Helm Chart Configuration
velero_helm_repo: "https://vmware-tanzu.github.io/helm-charts"
velero_helm_chart: "velero"
velero_helm_values_file: "velero-values.yml"

# Backup Verification
velero_enable_backup_verification: true
velero_verification_schedule: "0 4 * * 0"  # Weekly on Sunday at 4 AM

# Disaster Recovery
velero_dr_enabled: true
velero_dr_test_schedule: "0 3 1 * *"  # Monthly on 1st at 3 AM
velero_dr_restore_namespace_suffix: "-dr-test"
