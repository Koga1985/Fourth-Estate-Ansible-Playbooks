---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: namespace-isolation
  namespace: {{ item.namespace }}
  labels:
    app.kubernetes.io/managed-by: ansible
    security.fourth-estate.io/policy-type: namespace-isolation
spec:
  podSelector: {}
  policyTypes:
    - Ingress
  ingress:
{% if item.allow_namespaces is defined %}
{% for allowed_ns in item.allow_namespaces %}
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: {{ allowed_ns }}
{% endfor %}
{% endif %}
