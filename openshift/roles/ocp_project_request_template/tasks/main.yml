---

- name: Ensure artifacts directory exists
  ansible.builtin.file:
    path: "{{ artifacts_dir }}"
    state: directory
    mode: "0755"


- name: Apply ProjectRequest template
  kubernetes.core.k8s:
    kubeconfig: "{{ kubeconfig }}"
    state: present
    definition: "{{ project_template }}"

- name: Set Project configuration to use template
  kubernetes.core.k8s:
    kubeconfig: "{{ kubeconfig }}"
    state: present
    definition:
      apiVersion: config.openshift.io/v1
      kind: Project
      metadata: { name: cluster }
      spec:
        projectRequestTemplate:
          name: "{{ project_template.metadata.name if project_template.metadata is defined else 'project-request' }}"

