---
- name: Set runtime environment variables
  when: apply_changes | bool
  ansible.controller.settings:
    controller_host: "{{ controller_host }}"
    controller_oauthtoken: "{{ controller_oauthtoken }}"
    validate_certs: "{{ validate_certs }}"
    settings:
      AWX_TASK_ENV:
        PYTHONPATH: "/usr/lib/python{{ runtime_python_version }}/site-packages"
        ANSIBLE_FORCE_COLOR: "false"
        ANSIBLE_HOST_KEY_CHECKING: "false"

- name: Configure job timeout
  when: apply_changes | bool
  ansible.controller.settings:
    controller_host: "{{ controller_host }}"
    controller_oauthtoken: "{{ controller_oauthtoken }}"
    validate_certs: "{{ validate_certs }}"
    settings:
      DEFAULT_JOB_TIMEOUT: "{{ runtime_job_timeout }}"
      MAX_FORKS: "{{ runtime_max_forks }}"

- name: Enable FIPS mode
  when: apply_changes | bool and fourth_estate_fips_mode | bool
  ansible.controller.settings:
    controller_host: "{{ controller_host }}"
    controller_oauthtoken: "{{ controller_oauthtoken }}"
    validate_certs: "{{ validate_certs }}"
    settings:
      FIPS_MODE: true

- name: Display runtime baseline
  ansible.builtin.debug:
    msg:
      - "Python: {{ runtime_python_version }}"
      - "Ansible: {{ runtime_ansible_version }}"
      - "FIPS: {{ fourth_estate_fips_mode }}"
