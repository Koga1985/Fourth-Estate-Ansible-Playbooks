---
# Handlers for ans_ctrl_backup_and_audit
- name: Upload backup to S3
  amazon.aws.s3_object:
    bucket: "{{ dr_s3_bucket }}"
    object: "backups/{{ backup_filename }}"
    src: "{{ backup_path }}/{{ backup_filename }}"
    mode: put
    aws_access_key: "{{ dr_s3_access_key }}"
    aws_secret_key: "{{ dr_s3_secret_key }}"
    region: "{{ dr_s3_region }}"
  listen: "upload backup"
  when: dr_enabled | bool and dr_remote_storage == 's3'

- name: Send audit report
  ansible.builtin.mail:
    to: "{{ compliance_recipients }}"
    subject: "Ansible Controller Audit Report - {{ ansible_date_time.date }}"
    body: "Audit report attached"
  listen: "send audit"
  when: compliance_reports_enabled | bool
