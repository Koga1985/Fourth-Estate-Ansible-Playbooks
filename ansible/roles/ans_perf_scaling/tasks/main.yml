---
- name: Enable fact caching
  when: apply_changes | bool and enable_fact_caching | bool
  ansible.controller.settings:
    controller_host: "{{ controller_host }}"
    controller_oauthtoken: "{{ controller_oauthtoken }}"
    validate_certs: "{{ validate_certs }}"
    settings:
      AWX_FACTS_CACHE_TIMEOUT: "{{ fact_cache_timeout }}"

- name: Configure database pool
  when: apply_changes | bool
  ansible.controller.settings:
    controller_host: "{{ controller_host }}"
    controller_oauthtoken: "{{ controller_oauthtoken }}"
    validate_certs: "{{ validate_certs }}"
    settings:
      DATABASE_POOL_SIZE: "{{ db_connection_pool_size }}"
      DATABASE_MAX_OVERFLOW: "{{ db_max_overflow }}"

- name: Enable pipelining
  when: apply_changes | bool and enable_pipelining | bool
  ansible.controller.settings:
    controller_host: "{{ controller_host }}"
    controller_oauthtoken: "{{ controller_oauthtoken }}"
    validate_certs: "{{ validate_certs }}"
    settings:
      AWX_PIPELINING: true

- name: Display performance summary
  ansible.builtin.debug:
    msg:
      - "Fact Caching: {{ enable_fact_caching }}"
      - "Max Forks: {{ max_forks }}"
      - "HA Enabled: {{ fourth_estate_high_availability }}"
