---
# Handlers for ans_ci_pipelines role
- name: Notify CI pipeline created
  ansible.builtin.debug:
    msg: "CI/CD pipeline configuration has been created for {{ ci_platform }}"
  listen: "ci configured"

- name: Trigger initial pipeline run
  ansible.builtin.uri:
    url: "{{ controller_host }}/api/v2/workflow_job_templates/{{ workflow_id }}/launch/"
    method: POST
    headers:
      Authorization: "Bearer {{ controller_oauthtoken }}"
    validate_certs: "{{ validate_certs }}"
    status_code: [201, 202]
  listen: "trigger pipeline"
  when: workflow_id is defined
