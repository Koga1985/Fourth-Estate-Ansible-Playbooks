---
- name: Create workflow job templates
  when: apply_changes | bool
  ansible.controller.workflow_job_template:
    controller_host: "{{ controller_host }}"
    controller_oauthtoken: "{{ controller_oauthtoken }}"
    validate_certs: "{{ validate_certs }}"
    name: "{{ item.name }}"
    organization: "Fourth Estate"
    state: present
  loop: "{{ workflow_templates }}"

- name: Enable deployment pipeline
  when: apply_changes | bool and fourth_estate_deployment_pipeline | bool
  ansible.controller.workflow_job_template:
    controller_host: "{{ controller_host }}"
    controller_oauthtoken: "{{ controller_oauthtoken }}"
    validate_certs: "{{ validate_certs }}"
    name: "Deployment Pipeline"
    organization: "Fourth Estate"
    ask_inventory_on_launch: true
    state: present

- name: Display workflow summary
  ansible.builtin.debug:
    msg:
      - "Workflows: {{ workflow_templates | length }}"
      - "Deployment Pipeline: {{ fourth_estate_deployment_pipeline }}"
