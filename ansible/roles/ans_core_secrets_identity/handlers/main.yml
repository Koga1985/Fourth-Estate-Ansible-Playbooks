---
# Handlers for ans_core_secrets_identity
- name: Rotate secrets
  ansible.builtin.debug:
    msg: "Secret rotation triggered"
  listen: "rotate secrets"
  when: secret_rotation_enabled | bool

- name: Audit secret access
  ansible.builtin.lineinfile:
    path: "{{ artifacts_dir }}/secret_access_audit.log"
    line: "{{ ansible_date_time.iso8601 }} - Secret accessed: {{ secret_name | default('unknown') }}"
    create: true
    mode: "0600"
  listen: "audit access"
  when: fourth_estate_audit_secret_access | bool
