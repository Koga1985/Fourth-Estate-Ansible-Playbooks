---
# handlers file for netapp_svm_management

- name: verify svm creation
  netapp.ontap.na_ontap_info:
    hostname: "{{ netapp_svm_hostname }}"
    username: "{{ netapp_svm_username }}"
    password: "{{ netapp_svm_password }}"
    https: true
    validate_certs: "{{ netapp_svm_validate_certs }}"
    gather_subset:
      - vserver_info
  delegate_to: localhost
  register: svm_verify

- name: restart nfs service
  netapp.ontap.na_ontap_nfs:
    hostname: "{{ netapp_svm_hostname }}"
    username: "{{ netapp_svm_username }}"
    password: "{{ netapp_svm_password }}"
    https: true
    validate_certs: "{{ netapp_svm_validate_certs }}"
    vserver: "{{ netapp_svm_name }}"
    service_state: started
  delegate_to: localhost

- name: restart cifs service
  netapp.ontap.na_ontap_command:
    hostname: "{{ netapp_svm_hostname }}"
    username: "{{ netapp_svm_username }}"
    password: "{{ netapp_svm_password }}"
    https: true
    validate_certs: "{{ netapp_svm_validate_certs }}"
    command: ['vserver', 'cifs', 'restart', '-vserver', '{{ netapp_svm_name }}']
  delegate_to: localhost
  changed_when: true

- name: verify lif status
  netapp.ontap.na_ontap_info:
    hostname: "{{ netapp_svm_hostname }}"
    username: "{{ netapp_svm_username }}"
    password: "{{ netapp_svm_password }}"
    https: true
    validate_certs: "{{ netapp_svm_validate_certs }}"
    gather_subset:
      - net_interface_info
  delegate_to: localhost
