---
# handlers file for netapp_volume_provisioning

- name: verify volume creation
  netapp.ontap.na_ontap_info:
    hostname: "{{ netapp_volume_hostname }}"
    username: "{{ netapp_volume_username }}"
    password: "{{ netapp_volume_password }}"
    https: true
    validate_certs: "{{ netapp_volume_validate_certs }}"
    gather_subset:
      - volume_info
  delegate_to: localhost
  register: volume_status

- name: restart efficiency
  netapp.ontap.na_ontap_command:
    hostname: "{{ netapp_volume_hostname }}"
    username: "{{ netapp_volume_username }}"
    password: "{{ netapp_volume_password }}"
    https: true
    validate_certs: "{{ netapp_volume_validate_certs }}"
    command: ['volume', 'efficiency', 'start', '-vserver', '{{ netapp_volume_svm }}', '-volume', '*']
  delegate_to: localhost
  changed_when: true

- name: update quota
  netapp.ontap.na_ontap_command:
    hostname: "{{ netapp_volume_hostname }}"
    username: "{{ netapp_volume_username }}"
    password: "{{ netapp_volume_password }}"
    https: true
    validate_certs: "{{ netapp_volume_validate_certs }}"
    command: ['volume', 'quota', 'resize', '-vserver', '{{ netapp_volume_svm }}']
  delegate_to: localhost
  changed_when: true
