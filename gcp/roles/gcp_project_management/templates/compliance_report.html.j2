<!DOCTYPE html>
<html>
<head>
    <title>GCP Project Compliance Report - {{ gcp_project_id }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        h1 { color: #1a73e8; }
        h2 { color: #34a853; margin-top: 30px; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #1a73e8; color: white; }
        .pass { color: #34a853; font-weight: bold; }
        .fail { color: #ea4335; font-weight: bold; }
        .info { background-color: #e8f0fe; padding: 15px; margin: 20px 0; border-left: 4px solid #1a73e8; }
    </style>
</head>
<body>
    <h1>GCP Project Compliance Report</h1>
    <div class="info">
        <strong>Project ID:</strong> {{ gcp_project_id }}<br>
        <strong>Project Name:</strong> {{ gcp_project_name }}<br>
        <strong>Generated:</strong> {{ ansible_date_time.iso8601 }}<br>
        <strong>Compliance Framework:</strong> {{ gcp_assured_workload_regime | default('FedRAMP High') }}
    </div>

    <h2>Security Posture</h2>
    <table>
        <tr>
            <th>Control</th>
            <th>Status</th>
            <th>Details</th>
        </tr>
        <tr>
            <td>Deletion Protection</td>
            <td class="{{ 'pass' if gcp_enable_deletion_protection else 'fail' }}">
                {{ 'ENABLED' if gcp_enable_deletion_protection else 'DISABLED' }}
            </td>
            <td>Project resource deletion lien</td>
        </tr>
        <tr>
            <td>Assured Workloads</td>
            <td class="{{ 'pass' if gcp_enable_assured_workloads else 'fail' }}">
                {{ 'ENABLED' if gcp_enable_assured_workloads else 'DISABLED' }}
            </td>
            <td>{{ gcp_assured_workload_regime | default('N/A') }}</td>
        </tr>
        <tr>
            <td>VPC Service Controls</td>
            <td class="{{ 'pass' if gcp_enable_vpc_service_controls else 'fail' }}">
                {{ 'ENABLED' if gcp_enable_vpc_service_controls else 'DISABLED' }}
            </td>
            <td>Data exfiltration prevention</td>
        </tr>
        <tr>
            <td>Organization Policies</td>
            <td class="{{ 'pass' if gcp_enforce_org_policies else 'fail' }}">
                {{ 'ENFORCED' if gcp_enforce_org_policies else 'NOT ENFORCED' }}
            </td>
            <td>Enterprise governance controls</td>
        </tr>
    </table>

    <h2>Organization Policies</h2>
    <table>
        <tr>
            <th>Policy</th>
            <th>Status</th>
        </tr>
        <tr><td>Domain Restricted Sharing</td><td class="pass">ENFORCED</td></tr>
        <tr><td>Disable Service Account Key Creation</td><td class="pass">ENFORCED</td></tr>
        <tr><td>Require OS Login</td><td class="pass">ENFORCED</td></tr>
        <tr><td>Disable Serial Port Access</td><td class="pass">ENFORCED</td></tr>
        <tr><td>Require Shielded VMs</td><td class="pass">ENFORCED</td></tr>
        <tr><td>Skip Default Network Creation</td><td class="pass">ENFORCED</td></tr>
        <tr><td>Restrict Public IPs</td><td class="pass">{{ 'ENFORCED' if gcp_restrict_public_ips else 'NOT ENFORCED' }}</td></tr>
        <tr><td>Uniform Bucket-Level Access</td><td class="pass">ENFORCED</td></tr>
        <tr><td>Resource Location Restriction</td><td class="pass">ENFORCED</td></tr>
    </table>

    <h2>Data Residency</h2>
    <table>
        <tr>
            <th>Configuration</th>
            <th>Value</th>
        </tr>
        <tr>
            <td>Allowed Locations</td>
            <td>{{ gcp_allowed_locations | join(', ') }}</td>
        </tr>
        <tr>
            <td>Primary Region</td>
            <td>{{ gcp_assured_workload_location | default('us-east1') }}</td>
        </tr>
    </table>

    <h2>Fourth Estate Specific Controls</h2>
    <table>
        <tr>
            <th>Control</th>
            <th>Status</th>
        </tr>
        <tr><td>Source Protection Isolation</td><td class="pass">ENABLED</td></tr>
        <tr><td>Journalist Access Controls</td><td class="pass">ENABLED</td></tr>
        <tr><td>365+ Day Audit Retention</td><td class="pass">ENABLED</td></tr>
        <tr><td>CMEK Encryption</td><td class="pass">REQUIRED</td></tr>
        <tr><td>Multi-Region HA</td><td class="pass">ENABLED</td></tr>
    </table>

    <h2>Essential Contacts</h2>
    <table>
        <tr>
            <th>Email</th>
            <th>Categories</th>
        </tr>
        {% for contact in gcp_essential_contacts %}
        <tr>
            <td>{{ contact.email }}</td>
            <td>{{ contact.categories | join(', ') }}</td>
        </tr>
        {% endfor %}
    </table>
</body>
</html>
