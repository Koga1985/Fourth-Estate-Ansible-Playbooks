---
# Organization-level IAM policy bindings

- name: Apply organization-level IAM policy bindings
  ansible.builtin.command:
    cmd: >
      gcloud organizations add-iam-policy-binding {{ gcp_organization_id }}
      --member={{ item.member }}
      --role={{ item.role }}
  loop: "{{ gcp_iam_org_policy_bindings }}"
  register: org_policy_result
  changed_when: "'Updated IAM policy' in org_policy_result.stdout"

- name: Apply organization-level conditional bindings
  ansible.builtin.command:
    cmd: >
      gcloud organizations add-iam-policy-binding {{ gcp_organization_id }}
      --member={{ item.member }}
      --role={{ item.role }}
      --condition={{ item.condition | to_json | quote }}
  loop: "{{ gcp_iam_org_policy_bindings }}"
  when: item.condition is defined
  register: org_conditional_result
  changed_when: "'Updated IAM policy' in org_conditional_result.stdout"
