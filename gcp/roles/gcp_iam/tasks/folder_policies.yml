---
# Folder-level IAM policy bindings

- name: Apply folder-level IAM policy bindings
  ansible.builtin.command:
    cmd: >
      gcloud resource-manager folders add-iam-policy-binding {{ item.folder_id }}
      --member={{ item.member }}
      --role={{ item.role }}
  loop: "{{ gcp_iam_folder_policy_bindings }}"
  register: folder_policy_result
  changed_when: "'Updated IAM policy' in folder_policy_result.stdout"

- name: Apply folder-level conditional bindings
  ansible.builtin.command:
    cmd: >
      gcloud resource-manager folders add-iam-policy-binding {{ item.folder_id }}
      --member={{ item.member }}
      --role={{ item.role }}
      --condition={{ item.condition | to_json | quote }}
  loop: "{{ gcp_iam_folder_policy_bindings }}"
  when: item.condition is defined
  register: folder_conditional_result
  changed_when: "'Updated IAM policy' in folder_conditional_result.stdout"
