<?xml version="1.0" encoding="UTF-8"?>
<unload unload_date="{{ ansible_date_time.iso8601 }}">
  <cmdb_health_check action="INSERT_OR_UPDATE">
    <name>{{ item.name }}</name>
    <description>{{ item.name }} - Automated health check for CMDB data quality</description>
    <active>{{ item.enabled | default(true) | lower }}</active>
    <severity>{{ item.severity | default('medium') }}</severity>
    <check_type>{{ item.name | regex_replace(' ', '_') | lower }}</check_type>
    <tables>{{ item.tables | join(',') if item.tables is defined else '' }}</tables>
    <threshold>{{ item.age_threshold_days | default(90) }}</threshold>
    <schedule>0 2 * * *</schedule>
  </cmdb_health_check>
</unload>
