---
# ServiceNow Integration Playbook
# Entry point for ServiceNow ITSM automation
#
# Usage:
#   ansible-galaxy collection install -r requirements.yml
#   ansible-playbook -i inventory site.yml --ask-vault-pass

- name: ServiceNow Configuration
  hosts: localhost
  connection: local
  gather_facts: true

  vars:
    deploy_integration: true
    deploy_cmdb: true
    deploy_incidents: true
    deploy_changes: true
    deploy_assets: true
    deploy_reporting: true

  tasks:
    - name: Phase 1 - ServiceNow Integration
      ansible.builtin.include_role:
        name: servicenow_integration
      when: deploy_integration | bool
      tags: ['integration', 'phase1']

    - name: Phase 2 - CMDB Configuration
      ansible.builtin.include_role:
        name: servicenow_cmdb_config
      when: deploy_cmdb | bool
      tags: ['cmdb', 'phase2']

    - name: Phase 3 - CI Discovery
      ansible.builtin.include_role:
        name: servicenow_ci_discovery
      when: deploy_cmdb | bool
      tags: ['cmdb', 'discovery', 'phase3']

    - name: Phase 4 - CI Updates
      ansible.builtin.include_role:
        name: servicenow_ci_updates
      when: deploy_cmdb | bool
      tags: ['cmdb', 'phase4']

    - name: Phase 5 - Incident Management
      ansible.builtin.include_role:
        name: servicenow_incident_management
      when: deploy_incidents | bool
      tags: ['incidents', 'phase5']

    - name: Phase 6 - Change Management
      ansible.builtin.include_role:
        name: servicenow_change_management
      when: deploy_changes | bool
      tags: ['changes', 'phase6']

    - name: Phase 7 - Asset Management
      ansible.builtin.include_role:
        name: servicenow_asset_management
      when: deploy_assets | bool
      tags: ['assets', 'phase7']

    - name: Phase 8 - Reporting
      ansible.builtin.include_role:
        name: servicenow_reporting
      when: deploy_reporting | bool
      tags: ['reporting', 'phase8']

    - name: Display summary
      ansible.builtin.debug:
        msg:
          - "=== ServiceNow Integration Complete ==="
          - "Instance: {{ servicenow_instance }}"
      tags: ['always']
