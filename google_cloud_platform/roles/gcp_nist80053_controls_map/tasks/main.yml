---
- name: Ensure artifacts directory
  ansible.builtin.file:
    path: "{{ artifacts_dir | default('/tmp/gcp-artifacts') }}"
    state: directory
    mode: "0755"


- name: Render NIST 800-53 mapping
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/nist80053_controls_map.json"
    mode: "0644"
    content: "{{ { 'controls': controls | default([]) } | to_nice_json }}"


- name: Emit NIST control evidence CSV
  ansible.builtin.copy:
    dest: "{{ artifacts_dir }}/nist80053_controls_evidence.csv"
    mode: "0644"
    content: "control,owner,implementation_ref,evidence_artifact,last_updated\n"
