---
# Prometheus Installation Role - Handlers
# Fourth Estate Agency - Infrastructure Monitoring

- name: restart prometheus
  systemd:
    name: prometheus
    state: restarted
    daemon_reload: true
  when: prometheus_restart_on_change

- name: reload prometheus
  systemd:
    name: prometheus
    state: reloaded
  failed_when: false

- name: validate prometheus config
  command: "{{ prometheus_install_dir }}/promtool check config {{ prometheus_config_dir }}/prometheus.yml"
  changed_when: false

- name: check prometheus service status
  systemd:
    name: prometheus
    state: started
  register: prometheus_service_status
  changed_when: false
