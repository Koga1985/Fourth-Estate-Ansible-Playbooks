#!/bin/bash
# Vault HA Monitoring Script
# Generated by Ansible - DO NOT EDIT MANUALLY

set -euo pipefail

VAULT_ADDR="{{ vault_api_addr }}"
VAULT_CACERT="{{ vault_tls_ca_file }}"

# Check HA status
HA_STATUS=$(curl -s -k --cacert "${VAULT_CACERT}" "${VAULT_ADDR}/v1/sys/ha-status" || echo "FAILED")

if echo "${HA_STATUS}" | grep -q "ha_enabled"; then
    HA_ENABLED=$(echo "${HA_STATUS}" | jq -r '.ha_enabled')
    LEADER_ADDR=$(echo "${HA_STATUS}" | jq -r '.leader_address // "unknown"')

    echo "$(date '+%Y-%m-%d %H:%M:%S') - HA Status: Enabled=${HA_ENABLED}, Leader=${LEADER_ADDR}"
else
    echo "$(date '+%Y-%m-%d %H:%M:%S') - ERROR: Unable to get HA status"
    exit 1
fi

exit 0
